<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesor Juan Mel√©ndez - Contrata Totalplay Fibra √ìptica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '763739910017100');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=763739910017100&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f0f0f;
            overflow-x: hidden;
            color: #FFFFFF;
        }
        .professional-gradient {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            position: relative;
            overflow: hidden;
        }
        .professional-gradient::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(41, 98, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 0, 255, 0.05) 0%, transparent 50%);
            z-index: 1;
        }
        .accent-text {
            color: #2962FF;
            font-weight: 700;
        }
        .promo-gradient {
            background: linear-gradient(45deg, #2962FF, #00FFFF);
        }
        .custom-checkbox:checked, .custom-radio:checked {
            background-color: #2962FF;
            border-color: #00FFFF;
        }
        .fade-out {
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: opacity 0.5s ease, height 0.5s ease;
        }
        .fade-in {
            opacity: 1;
            height: auto;
            overflow: visible;
            transition: opacity 0.5s ease, height 0.5s ease;
        }
        .section-hidden {
            display: none;
        }
        .form-loading {
            position: relative;
            pointer-events: none;
        }
        .form-loading::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
        }
        .discount-badge {
            background-color: #2962FF;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        .disney-promo {
            background: linear-gradient(135deg, #1a1a1a 0%, #2962FF 100%);
            border-left: 4px solid #00FFFF;
        }
        .promo-tag {
            background-color: #2962FF;
            color: #FFFFFF;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        /* Estilo para Netflix similar al original */
        .netflix-text {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-weight: 900;
            color: #E50914;
            text-transform: uppercase;
            letter-spacing: -1px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        
        /* Colores espec√≠ficos para cada plan respetando los originales */
        .plan-100 {
            background: linear-gradient(135deg, #8b4513, #daa520);
            color: #fff;
            border: 1px solid #daa520;
        }
        
        .plan-200 {
            background: linear-gradient(135deg, #228b22, #32cd32);
            color: #000;
            border: 1px solid #32cd32;
        }
        
        .plan-300 {
            background: linear-gradient(135deg, #4b0082, #8a2be2);
            color: #fff;
            border: 1px solid #8a2be2;
        }
        
        .plan-500 {
            background: linear-gradient(135deg, #ff4500, #ff8c00);
            color: #000;
            border: 1px solid #ff8c00;
        }
        
        .plan-1200 {
            background: linear-gradient(135deg, #8b0000, #dc143c);
            color: #fff;
            border: 1px solid #dc143c;
        }
        
        .plan-5000 {
            background: linear-gradient(135deg, #00008b, #4169e1);
            color: #fff;
            border: 1px solid #4169e1;
        }
        
        .plan-10000 {
            background: linear-gradient(135deg, #4b0082, #9400d3);
            color: #fff;
            border: 1px solid #9400d3;
        }
        
        /* Botones con tem√°tica del Buen Mes */
        .btn-buen-mes {
            background: linear-gradient(135deg, #2962FF, #00FFFF);
            color: white;
            font-weight: 700;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-buen-mes:hover {
            background: linear-gradient(135deg, #00FFFF, #2962FF);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 98, 255, 0.4);
        }
        
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background-color: #1a1a1a;
        }
        
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(41, 98, 255, 0.2);
        }
        
        .benefit-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            color: #BDBDBD;
        }
        
        .benefit-item:before {
            content: "‚úì";
            margin-right: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            color: #2962FF;
        }
        
        /* BADGE RECOMENDADO CORREGIDO - Sin superposici√≥n */
        .recommended-badge {
            position: absolute;
            top: -18px; /* Aumentado para subirlo m√°s y evitar superposici√≥n */
            right: 20px;
            background: linear-gradient(135deg, #00FFFF, #2962FF);
            color: #000000;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 900;
            z-index: 25; /* Aumentado para mayor prioridad sobre otros elementos */
            box-shadow: 0 0 10px #00FFFF, 0 0 20px #00FFFF, 0 0 30px #00FFFF;
            animation: professionalPulse 2s infinite alternate;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        @keyframes professionalPulse {
            0% {
                box-shadow: 0 0 5px #00FFFF, 0 0 10px #00FFFF, 0 0 15px #00FFFF;
                transform: scale(1);
            }
            100% {
                box-shadow: 0 0 15px #00FFFF, 0 0 25px #00FFFF, 0 0 35px #00FFFF;
                transform: scale(1.05);
            }
        }
        
        input[type="checkbox"], input[type="radio"] {
            accent-color: #2962FF;
        }
        
        .has-\[\:\checked\]\:bg-indigo-900\/50:has(:checked) {
            background-color: rgba(41, 98, 255, 0.2);
        }
        
        .has-\[\:\checked\]\:border-indigo-500:has(:checked) {
            border-color: #2962FF;
        }
        
        /* Animaci√≥n para el Buen Mes */
        .buen-mes-button {
            position: relative;
            overflow: hidden;
        }
        
        .buen-mes-button::before {
            content: "üéÅ‚ú®";
            position: absolute;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            animation: buenMesMove 3s infinite ease-in-out, buenMesBlink 2s infinite;
            z-index: 1;
        }
        
        @keyframes buenMesMove {
            0%, 100% {
                transform: translateY(-50%) translateX(0);
            }
            25% {
                transform: translateY(-60%) translateX(5px);
            }
            50% {
                transform: translateY(-50%) translateX(10px);
            }
            75% {
                transform: translateY(-40%) translateX(5px);
            }
        }
        
        @keyframes buenMesBlink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.3;
            }
        }
        
        .buen-mes-button span {
            position: relative;
            z-index: 2;
        }
        
        /* Encabezados de promoci√≥n con z-index ajustado */
        .promo-header {
            position: relative;
            z-index: 15;
        }
        
        /* Estilos para la secci√≥n de regalos */
        .gift-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2962FF 100%);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid #00FFFF;
        }
        
        .gift-option {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .gift-option:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }
        
        .gift-option.selected {
            border-color: #00FFFF;
            background: rgba(0, 255, 255, 0.1);
        }
        
        .gift-emoji {
            animation: giftPulse 2s infinite;
            display: inline-block;
        }
        
        @keyframes giftPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }
        
        .gift-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00FFFF;
        }
        
        .gift-price-small {
            font-size: 0.9rem;
            color: #BDBDBD;
            margin-top: 0.25rem;
        }
        
        /* Estilos para las nuevas promociones directas - MEJORADO */
        .direct-promo-banner {
            background: linear-gradient(135deg, #87CEEB, #B0E0E6); /* Celeste claro por fuera */
            border-radius: 1.5rem;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 3px solid #1E90FF;
            position: relative;
            overflow: hidden;
        }
        
        .direct-promo-banner::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(30, 144, 255, 0.9), rgba(0, 105, 255, 0.9)); /* Azul fuerte por dentro */
            z-index: 1;
        }
        
        .direct-promo-banner > * {
            position: relative;
            z-index: 2;
        }
        
        .direct-promo-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .direct-promo-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border-color: #FFFFFF;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .direct-promo-price {
            font-size: 3rem;
            font-weight: 900;
            color: #FFFFFF;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            margin: 1rem 0;
        }
        
        .direct-promo-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000000;
            font-weight: 800;
            padding: 1rem 2rem;
            border-radius: 3rem;
            transition: all 0.3s ease;
            display: inline-block;
            margin-top: 1.5rem;
            border: 2px solid #FFFFFF;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1.1rem;
        }
        
        .direct-promo-btn:hover {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 165, 0, 0.6);
            color: #000000;
        }
        
        /* Mejoras de contraste para el texto */
        .direct-promo-title {
            color: #FFFFFF;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-weight: 900;
            font-size: 2.5rem;
        }
        
        .direct-promo-subtitle {
            color: #FFFFFF;
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }
        
        .direct-promo-card-title {
            color: #FFFFFF;
            font-weight: 800;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .direct-promo-card-text {
            color: #E6F7FF;
            font-weight: 500;
        }
        
        .direct-promo-card-highlight {
            color: #FFD700;
            font-weight: 700;
        }
        
        .direct-promo-benefit {
            color: #E6F7FF;
            font-weight: 500;
            margin: 0.5rem 0;
        }
        
        /* Estilos para precios con descuento */
        .price-display {
            margin: 1rem 0;
        }
        
        .promo-price {
            font-size: 2.5rem;
            font-weight: 900;
            color: #FFFFFF;
        }
        
        .regular-price {
            font-size: 1.2rem;
            color: #BDBDBD;
            text-decoration: line-through;
            margin-left: 0.5rem;
        }
        
        .price-description {
            font-size: 0.9rem;
            color: #00FFFF;
            margin-top: 0.5rem;
        }
        
        .price-after-discount {
            font-size: 1rem;
            color: #BDBDBD;
            margin-top: 0.25rem;
        }
        
        /* NUEVO: Estilo para el logo del Buen Mes en las tarjetas de plan */
        .buen-mes-logo {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 80px;
            height: auto;
            z-index: 20;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }
        
        @media (max-width: 768px) {
            .buen-mes-logo {
                width: 60px;
                top: 8px;
                left: 8px;
            }
        }
    </style>
</head>
<body class="bg-[#0f0f0f] text-white">

    <!-- Header -->
    <header class="bg-[#1a1a1a]/80 backdrop-blur-sm sticky top-0 z-50 shadow-lg border-b border-[#424242]">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-xl md:text-2xl font-bold text-white">
                <span class="accent-text">Asesor Autorizado</span> Totalplay¬Æ
            </div>
            <div class="text-right">
                <p class="font-semibold">Juan Mel√©ndez</p>
                <p class="text-sm text-[#BDBDBD]">Tu experto en conectividad</p>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <main class="container mx-auto px-6">
        <!-- NUEVAS PROMOCIONES DIRECTAS - MEJORADAS VISUALMENTE -->
        <section id="promociones-directas" class="py-8">
            <div class="direct-promo-banner">
                <h2 class="direct-promo-title text-center mb-4">üî• NUEVAS PROMOCIONES DIRECTAS üî•</h2>
                <p class="direct-promo-subtitle text-center">Contrata directamente sin complicaciones y disfruta de estos incre√≠bles precios</p>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Promoci√≥n Solo Internet 80 Megas -->
                    <div class="direct-promo-card">
                        <div class="text-center">
                            <h3 class="direct-promo-card-title">Solo Internet</h3>
                            <div class="direct-promo-price">$390<span class="text-2xl">/mes</span></div>
                            <p class="direct-promo-card-text mb-2">En pago puntual</p>
                            <p class="direct-promo-card-highlight mb-6">80 Megas navega ahora con 100 Megas</p>
                            
                            <div class="text-left space-y-2">
                                <div class="direct-promo-benefit">‚úì Fibra √≥ptica sim√©trica</div>
                                <div class="direct-promo-benefit">‚úì Instalaci√≥n sin costo</div>
                                <div class="direct-promo-benefit">‚úì Precio fijo por 12 meses</div>
                                <div class="direct-promo-benefit">‚úì Soporte t√©cnico 24/7</div>
                            </div>
                            
                            <button class="direct-promo-btn contratar-directo-btn" 
                                    data-plan="Solo Internet 80 Megas" 
                                    data-price="390"
                                    data-megas="80"
                                    data-promo-megas="100">
                                Contratar Directamente
                            </button>
                        </div>
                    </div>
                    
                    <!-- Promoci√≥n Internet + TV -->
                    <div class="direct-promo-card">
                        <div class="text-center">
                            <h3 class="direct-promo-card-title">Internet + TV</h3>
                            <div class="direct-promo-price">$490<span class="text-2xl">/mes</span></div>
                            <p class="direct-promo-card-text mb-2">En pago puntual</p>
                            <p class="direct-promo-card-highlight mb-6">80 Megas + Canales incluidos</p>
                            
                            <div class="text-left space-y-2">
                                <div class="direct-promo-benefit">‚úì 80 Megas navega ahora con 100 Megas</div>
                                <div class="direct-promo-benefit">‚úì M√°s de 150 canales</div>
                                <div class="direct-promo-benefit">‚úì Instalaci√≥n sin costo</div>
                                <div class="direct-promo-benefit">‚úì Precio fijo por 12 meses</div>
                            </div>
                            
                            <button class="direct-promo-btn contratar-directo-btn" 
                                    data-plan="Internet + TV 80 Megas + Canales" 
                                    data-price="490"
                                    data-megas="80"
                                    data-promo-megas="100">
                                Contratar Directamente
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="inicio" class="min-h-[80vh] flex items-center professional-gradient rounded-3xl mt-8 p-8 md:p-16 relative">
            <div class="max-w-3xl relative z-10">
                <h1 class="text-4xl md:text-6xl font-extrabold text-white leading-tight">
                    <span class="accent-text">¬°Experimenta la potencia de estos MEGAS!</span>
                </h1>
                <p class="mt-6 text-lg text-[#BDBDBD]">
                    ‚ö° Instalaci√≥n EXPRESS sin costo - Precio FIJO por 12 meses - Descuentos EXCLUSIVOS ‚ö°
                </p>
                <div id="promo-banner" class="mt-8 bg-[#1a1a1a] p-4 rounded-xl border border-[#424242]">
                    <p class="text-center font-bold text-[#00FFFF] text-lg">
                        üéÅ ¬°OFERTAS ESPECIALES por tiempo limitado! V√°lido desde el 1 de noviembre hasta el 17 de noviembre 2025.
                    </p>
                </div>
                <a href="#planes" id="ver-planes-btn" class="mt-10 inline-block btn-buen-mes buen-mes-button text-white font-bold text-lg py-4 px-10 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-300">
                    <span>Ver Planes INCRE√çBLES</span>
                </a>
            </div>
        </section>

        <!-- Plans Section -->
        <section id="planes" class="py-20">
            <div class="text-center">
                <div class="promo-gradient p-8 rounded-2xl mb-12 shadow-2xl border border-[#424242]">
                    <h2 class="text-4xl font-extrabold text-white">Elige el plan que transformar√° tu conectividad</h2>
                    <p class="text-[#BDBDBD] mt-2 text-lg">Velocidades ultrarr√°pidas que impresionan ‚ö°</p>
                </div>

                <div id="plan-type-buttons" class="flex justify-center gap-4 mb-10 bg-[#1a1a1a] p-2 rounded-full max-w-md mx-auto border border-[#424242]">
                    <button id="btn-internet" class="plan-type-btn flex-1 bg-transparent hover:bg-[#424242] text-white font-bold py-3 px-8 rounded-full transition-colors duration-300">Solo Internet</button>
                    <button id="btn-combo" class="plan-type-btn flex-1 bg-[#2962FF] text-white font-bold py-3 px-8 rounded-full transition-colors duration-300">Internet + TV</button>
                </div>

                <div id="plan-cards-container" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
                    <!-- Las tarjetas de planes se insertar√°n aqu√≠ con JS -->
                </div>
            </div>
        </section>

        <!-- Gift Selection Section -->
        <section id="gift-section" class="hidden py-12">
            <div class="max-w-4xl mx-auto gift-section">
                <h2 class="text-3xl font-bold text-center mb-6 text-white">
                    <span class="gift-emoji">üéÅ</span> ¬°Elige tu regalo de bienvenida!
                </h2>
                <p class="text-center text-[#BDBDBD] mb-8">Contrata hoy y recibe un regalo de bienvenida. Selecciona una de las siguientes opciones:</p>
                
                <div id="gift-options-container" class="space-y-4">
                    <!-- Las opciones de regalo se insertar√°n aqu√≠ con JS -->
                </div>
                
                <div class="mt-8 text-center">
                    <button id="btn-continue-gift" class="bg-[#00FFFF] hover:bg-[#00CCCC] text-black font-bold py-3 px-10 rounded-full transition-colors duration-300">
                        Continuar con mi selecci√≥n
                    </button>
                </div>
            </div>
        </section>

        <!-- Benefits Section -->
        <section id="beneficios" class="py-20">
            <h2 class="text-3xl font-bold text-center mb-12 accent-text">Beneficios excepcionales</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="bg-[#1a1a1a] p-8 rounded-2xl border border-[#424242] transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-[#00FFFF] mb-3">‚ö° Velocidad de √âLITE</h3>
                    <p class="text-[#BDBDBD]">Disfruta la misma velocidad para subir y descargar archivos. Rendimiento optimizado para todas tus necesidades.</p>
                </div>
                <div class="bg-[#1a1a1a] p-8 rounded-2xl border border-[#424242] transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-[#00FFFF] mb-3">üí∞ Precio Fijo GARANTIZADO</h3>
                    <p class="text-[#BDBDBD]">Te mantenemos el mismo precio durante 12 meses. Sin sorpresas en tu factura.</p>
                </div>
                <div class="bg-[#1a1a1a] p-8 rounded-2xl border border-[#424242] transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-[#00FFFF] mb-3">üõ†Ô∏è Soporte T√©cnico 24/7</h3>
                    <p class="text-[#BDBDBD]">Accede a nuestra l√≠nea de atenci√≥n t√©cnica 24/7 con especialistas siempre disponibles.</p>
                </div>
                <div class="bg-[#1a1a1a] p-8 rounded-2xl border border-[#424242] transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-[#00FFFF] mb-3">üîß Instalaci√≥n SIN COSTO</h3>
                    <p class="text-[#BDBDBD]">Instalaci√≥n profesional incluida con valor of $350 MXN. Paga hoy $0 por la instalaci√≥n.</p>
                </div>
            </div>
        </section>

        <!-- Add-ons Section -->
        <section id="addons-section" class="hidden py-12">
             <div id="addons-intro" class="max-w-3xl mx-auto text-center bg-[#1a1a1a] rounded-3xl p-8 md:p-12 border border-[#424242]">
                <h2 class="text-3xl font-bold mb-4 accent-text">¬°Personaliza tu paquete a tu medida!</h2>
                <p class="text-[#BDBDBD] mb-8">¬øDeseas agregar servicios de streaming, apps o dispositivos a tu plan?</p>
                 <div class="flex justify-center gap-4">
                    <button id="btn-addons-yes" class="bg-[#00FFFF] hover:bg-[#00CCCC] text-black font-bold py-3 px-10 rounded-full transition-colors duration-300">¬°S√≠, agregar!</button>
                    <button id="btn-addons-no" class="bg-[#424242] hover:bg-[#666666] text-white font-bold py-3 px-10 rounded-full transition-colors duration-300">No, gracias</button>
                </div>
            </div>
            
            <div id="addons-options" class="hidden max-w-4xl mx-auto mt-12 space-y-10">
                <!-- Las opciones de adicionales se insertar√°n aqu√≠ -->
            </div>
        </section>

        <!-- Contact Form & Summary Section -->
        <section id="contact-section" class="hidden py-20">
            <div class="max-w-4xl mx-auto bg-[#1a1a1a] p-8 md:p-12 rounded-3xl border border-[#424242] grid md:grid-cols-2 gap-12">
                <div>
                    <h2 class="text-3xl font-bold mb-2 accent-text">¬°Casi listo para disfrutar!</h2>
                    <p class="text-[#BDBDBD] mb-6">Completa tus datos para finalizar tu solicitud. Me pondr√© en contacto contigo a la brevedad para coordinar la instalaci√≥n.</p>
                    <form id="contact-form">
                        <div class="mb-4">
                            <label for="nombre" class="block mb-2 text-sm font-medium text-[#BDBDBD]">Nombre Completo</label>
                            <input type="text" id="nombre" name="nombre" class="bg-[#0f0f0f] border border-[#424242] text-white text-sm rounded-lg focus:ring-[#2962FF] focus:border-[#2962FF] block w-full p-2.5" placeholder="Tu nombre" required>
                        </div>
                        <div class="mb-4">
                            <label for="correo" class="block mb-2 text-sm font-medium text-[#BDBDBD]">Correo Electr√≥nico</label>
                            <input type="email" id="correo" name="correo" class="bg-[#0f0f0f] border border-[#424242] text-white text-sm rounded-lg focus:ring-[#2962FF] focus:border-[#2962FF] block w-full p-2.5" placeholder="tu@correo.com" required>
                        </div>
                        <div class="mb-6">
                            <label for="telefono" class="block mb-2 text-sm font-medium text-[#BDBDBD]">Tel√©fono (WhatsApp)</label>
                            <input type="tel" id="telefono" name="telefono" class="bg-[#0f0f0f] border border-[#424242] text-white text-sm rounded-lg focus:ring-[#2962FF] focus:border-[#2962FF] block w-full p-2.5" placeholder="10 d√≠gitos" required pattern="\d{10}">
                        </div>
                        <div class="mb-6">
                            <label class="flex items-center">
                                <input type="checkbox" id="portabilidad" name="portabilidad" class="custom-checkbox rounded">
                                <span class="ml-2 text-[#BDBDBD]">¬øDeseas portar tu n√∫mero? (Obt√©n descuento en tu segunda mensualidad)</span>
                            </label>
                        </div>
                    </form>
                </div>
                <div class="bg-[#0f0f0f] p-6 rounded-2xl flex flex-col border border-[#424242]">
                    <h3 class="text-xl font-bold mb-4 accent-text">Resumen de tu pedido</h3>
                    <div id="summary-content" class="space-y-3 text-[#BDBDBD] flex-grow">
                        <!-- El resumen se insertar√° aqu√≠ con JS -->
                    </div>
                     <div class="border-t border-[#424242] mt-4 pt-4">
                        <div class="flex justify-between items-center text-xl font-bold">
                            <span class="text-[#BDBDBD]">Total Mensual:</span>
                            <span id="summary-total" class="accent-text">$0</span>
                        </div>
                        <div class="text-sm text-[#BDBDBD] mt-1" id="summary-total-description">
                            <!-- Descripci√≥n del total se insertar√° aqu√≠ -->
                        </div>
                        <div class="flex justify-between items-center text-lg text-[#00FFFF] mt-2">
                            <span>Costo de Instalaci√≥n Extra:</span>
                            <span id="summary-install" class="text-[#00FFFF]">$0 (Valor $350)</span>
                        </div>
                        <div class="flex justify-between items-center text-xl font-bold mt-2 pt-2 border-t border-[#424242]">
                            <span class="text-[#BDBDBD]">Pago Inicial:</span>
                            <span id="summary-install-price" class="accent-text">$0</span>
                        </div>
                    </div>
                    <button id="btn-continue" type="button" class="mt-6 w-full bg-[#00FFFF] hover:bg-[#00CCCC] text-black font-bold py-3 px-6 rounded-full transition-colors duration-300 disabled:bg-[#424242] disabled:cursor-not-allowed flex items-center justify-center gap-2" disabled>
                        <span id="continue-text">Enviar solicitud por WhatsApp</span>
                        <div id="continue-loader" class="hidden w-5 h-5 border-2 border-black border-t-transparent rounded-full animate-spin"></div>
                    </button>
                    
                    <!-- Texto informativo agregado -->
                    <div class="mt-4 text-center">
                        <p class="text-xs text-[#BDBDBD]">
                            ‚ö†Ô∏è <strong>Importante:</strong> Por favor completa todos los campos del formulario antes de enviar tu solicitud. 
                            Tu informaci√≥n nos permitir√° contactarte para coordinar la instalaci√≥n de tu servicio.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section id="testimonios" class="py-20">
            <h2 class="text-3xl font-bold text-center mb-12 accent-text">Lo que dicen nuestros clientes satisfechos</h2>
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="bg-[#1a1a1a] p-8 rounded-2xl border border-[#424242]">
                    <p class="text-[#BDBDBD] mb-6">"La atenci√≥n de Juan fue excelente. Me explic√≥ todo con claridad y la instalaci√≥n fue s√∫per r√°pida. Internet vuela, 100% recomendado!"</p>
                    <div class="font-bold text-right text-[#00FFFF]">- Sof√≠a G.</div>
                </div>
                <div class="bg-[#1a1a1a] p-8 rounded-2xl border border-[#424242]">
                    <p class="text-[#BDBDBD] mb-6">"Ten√≠a muchas dudas sobre qu√© plan me conven√≠a para mis clases en l√≠nea y para jugar. El asesor me ayud√≥ a elegir el paquete perfecto y ahora todo funciona de maravilla."</p>
                    <div class="font-bold text-right text-[#00FFFF]">- Carlos M.</div>
                </div>
                <div class="bg-[#1a1a1a] p-8 rounded-2xl border border-[#424242]">
                    <p class="text-[#BDBDBD] mb-6">"Contratar fue muy sencillo y sin tanto rollo. Me gustaron las promociones que me ofreci√≥ y el servicio ha sido muy estable desde el primer d√≠a."</p>
                    <div class="font-bold text-right text-[#00FFFF]">- Laura V.</div>
                </div>
            </div>
        </section>
        
        <!-- Support Section -->
        <section id="soporte" class="py-20 text-center">
            <div class="bg-[#1a1a1a] max-w-2xl mx-auto p-8 rounded-2xl border border-[#424242]">
                <h2 class="text-2xl font-bold mb-4 accent-text">¬øNecesitas Soporte T√©cnico?</h2>
                <p class="text-[#BDBDBD] mb-4">Si ya eres cliente y presentas una falla, comun√≠cate directamente a la l√≠nea de soporte t√©cnico para una atenci√≥n inmediata.</p>
                <p class="text-3xl font-bold accent-text tracking-widest">800 510 0510</p>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-[#1a1a1a] mt-20 border-t border-[#424242]">
        <div class="container mx-auto px-6 py-8 text-center text-[#BDBDBD]">
            <p>&copy; <span id="current-year"></span> Juan Mel√©ndez - Asesor Autorizado Totalplay. Todos los derechos reservados.</p>
            <p class="text-sm mt-2">Este sitio es gestionado por un asesor de ventas autorizado. Totalplay¬Æ es una marca registrada.</p>
             <p class="text-xs mt-4">P√°gina creada por Juan Mel√©ndez</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- CONFIGURATION ---
            const WHATSAPP_NUMBER = '5218131191393';
            const MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/jigm042t5atf3tci3j82n3cxysiva3f0';
            
            // URL del logo del Buen Mes
            const BUEN_MES_LOGO_URL = 'https://www.totalplay.com.mx/assetsv2/img/buenfin/logo-bf.svg';
            
            // Verificar si estamos en periodo promocional (hasta el 17 de noviembre de 2025)
            function isPromoPeriod() {
                const today = new Date();
                const promoStart = new Date('2025-11-01');
                const promoEnd = new Date('2025-11-17');
                return today >= promoStart && today <= promoEnd;
            }
            
            // Datos de portabilidad (solo disponible durante promoci√≥n)
            const portabilityDiscount = isPromoPeriod() ? {
                'internet': 100,
                'combo': 200
            } : {
                'internet': 0,
                'combo': 0
            };
            
            // Gift options configuration - ACTUALIZADO: Opci√≥n 2 ahora por 5 meses
            const giftOptions = {
                '100': [
                    {
                        id: 'gift-100-1',
                        title: 'Opci√≥n 1',
                        description: '$60 de descuento por 5 meses',
                        discount: 60,
                        months: 5,
                        netflix: false
                    },
                    {
                        id: 'gift-100-2',
                        title: 'Opci√≥n 2',
                        description: '$60 de descuento por 5 meses + Netflix Gratis por 5 meses',
                        discount: 60,
                        months: 5,
                        netflix: true,
                        netflixPrice: 110
                    }
                ],
                '200': [
                    {
                        id: 'gift-200-1',
                        title: 'Opci√≥n 1',
                        description: '$60 de descuento por 5 meses',
                        discount: 60,
                        months: 5,
                        netflix: false
                    },
                    {
                        id: 'gift-200-2',
                        title: 'Opci√≥n 2',
                        description: '$60 de descuento por 5 meses + Netflix Gratis por 5 meses',
                        discount: 60,
                        months: 5,
                        netflix: true,
                        netflixPrice: 110
                    }
                ],
                '300': [
                    {
                        id: 'gift-300-1',
                        title: 'Opci√≥n 1',
                        description: '$70 de descuento por 5 meses',
                        discount: 70,
                        months: 5,
                        netflix: false
                    },
                    {
                        id: 'gift-300-2',
                        title: 'Opci√≥n 2',
                        description: '$70 de descuento por 5 meses + Netflix Gratis por 5 meses',
                        discount: 70,
                        months: 5,
                        netflix: true,
                        netflixPrice: 110
                    }
                ],
                '500': [
                    {
                        id: 'gift-500-1',
                        title: 'Opci√≥n 1',
                        description: '$150 de descuento por 5 meses',
                        discount: 150,
                        months: 5,
                        netflix: false
                    },
                    {
                        id: 'gift-500-2',
                        title: 'Opci√≥n 2',
                        description: '$150 de descuento por 5 meses + Netflix Gratis por 5 meses',
                        discount: 150,
                        months: 5,
                        netflix: true,
                        netflixPrice: 110
                    }
                ],
                '1200': [
                    {
                        id: 'gift-1200-1',
                        title: 'Opci√≥n 1',
                        description: '$150 de descuento por 5 meses',
                        discount: 150,
                        months: 5,
                        netflix: false
                    },
                    {
                        id: 'gift-1200-2',
                        title: 'Opci√≥n 2',
                        description: '$150 de descuento por 5 meses + Netflix Gratis por 5 meses',
                        discount: 150,
                        months: 5,
                        netflix: true,
                        netflixPrice: 110
                    }
                ],
                '5000': [
                    {
                        id: 'gift-5000-1',
                        title: 'Opci√≥n 1',
                        description: '$150 de descuento por 5 meses',
                        discount: 150,
                        months: 5,
                        netflix: false
                    },
                    {
                        id: 'gift-5000-2',
                        title: 'Opci√≥n 2',
                        description: '$150 de descuento por 5 meses + Netflix Gratis por 5 meses',
                        discount: 150,
                        months: 5,
                        netflix: true,
                        netflixPrice: 110
                    }
                ],
                '10000': [
                    {
                        id: 'gift-10000-1',
                        title: 'Opci√≥n 1',
                        description: '$150 de descuento por 5 meses',
                        discount: 150,
                        months: 5,
                        netflix: false
                    },
                    {
                        id: 'gift-10000-2',
                        title: 'Opci√≥n 2',
                        description: '$150 de descuento por 5 meses + Netflix Gratis por 5 meses',
                        discount: 150,
                        months: 5,
                        netflix: true,
                        netflixPrice: 110
                    }
                ]
            };
            
            // Eventos personalizados para Facebook Pixel
            function trackFacebookEvent(eventName, parameters) {
                if (typeof fbq !== 'undefined') {
                    fbq('track', eventName, parameters);
                }
            }
            
            // --- PLANS AND ADD-ONS DATA ---
            // PRECIOS ACTUALIZADOS seg√∫n la tabla proporcionada
            const plansData = {
                internet: [
                    { 
                        megas: 100, 
                        promoMegas: 200,
                        regularPrice: 510,
                        promoPrice: 460,
                        formattedDesc: ["Fibra √≥ptica", "Club WiFi Totalplay"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 20 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: true
                    },
                    { 
                        megas: 200, 
                        promoMegas: 300,
                        regularPrice: 620,
                        promoPrice: 570,
                        formattedDesc: ["Fibra √≥ptica", "Club WiFi", "Apple TV+ 1 a√±o"],
                        recommended: true,
                        lifetimeDiscount: isPromoPeriod() ? 20 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: true
                    },
                    { 
                        megas: 300, 
                        promoMegas: 500,
                        regularPrice: 730,
                        promoPrice: 680,
                        formattedDesc: ["Fibra √≥ptica", "Club WiFi", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 30 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: true
                    },
                    { 
                        megas: 500, 
                        promoMegas: 1200,
                        regularPrice: 880,
                        promoPrice: 830,
                        formattedDesc: ["Fibra √≥ptica", "WiFi 6", "Club WiFi", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 60 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: true
                    },
                    { 
                        megas: 1200, 
                        promoMegas: 1200,
                        regularPrice: 1550,
                        promoPrice: 1470,
                        formattedDesc: ["Fibra √≥ptica", "WiFi 6", "Club WiFi", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 80 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: false
                    },
                    { 
                        megas: 5000, 
                        promoMegas: 5000,
                        regularPrice: 2380,
                        promoPrice: 1999,
                        formattedDesc: ["Fibra √≥ptica", "WiFi 7", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 80 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: false
                    },
                    { 
                        megas: 10000, 
                        promoMegas: 10000,
                        regularPrice: 3080,
                        promoPrice: 2499,
                        formattedDesc: ["Fibra √≥ptica", "WiFi 7", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 80 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: false
                    }
                ],
                combo: [
                    { 
                        megas: 100, 
                        promoMegas: 200,
                        regularPrice: 650,
                        promoPrice: 600,
                        formattedDesc: ["185 canales", "Convertidor Smart TV"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 30 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: true
                    },
                    { 
                        megas: 200, 
                        promoMegas: 300,
                        regularPrice: 760,
                        promoPrice: 710,
                        formattedDesc: ["185 canales", "Convertidor Smart TV", "Alexa", "Apple TV+ 1 a√±o"],
                        recommended: true,
                        lifetimeDiscount: isPromoPeriod() ? 30 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: true
                    },
                    { 
                        megas: 300, 
                        promoMegas: 500,
                        regularPrice: 870,
                        promoPrice: 820,
                        formattedDesc: ["185 canales", "Convertidor Smart TV", "Alexa", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 40 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: true
                    },
                    { 
                        megas: 500, 
                        promoMegas: 1200,
                        regularPrice: 1050,
                        promoPrice: 1000,
                        formattedDesc: ["185 canales", "Convertidor Smart TV", "Alexa", "Bocinas B&O", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 50 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: true
                    },
                    { 
                        megas: 1200, 
                        promoMegas: 1200,
                        regularPrice: 1720,
                        promoPrice: 1640,
                        formattedDesc: ["185 canales", "Convertidor Smart TV", "Alexa", "Bocinas B&O", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 100 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: false
                    },
                    { 
                        megas: 5000, 
                        promoMegas: 5000,
                        regularPrice: 2880,
                        promoPrice: 2499,
                        formattedDesc: ["185 canales", "WiFi 7", "Servicio para 1 TV con Alexa y Totalplay Surround", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 100 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: false
                    },
                    { 
                        megas: 10000, 
                        promoMegas: 10000,
                        regularPrice: 3580,
                        promoPrice: 2999,
                        formattedDesc: ["185 canales", "WiFi 7", "Servicio para 1 TV con Alexa y Totalplay Surround", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 100 : 0,
                        discountFromMonth: 6,
                        showExtraMegas: false
                    }
                ]
            };

            const addonsData = {
                streaming: {
                    prime: { id: 'prime', name: 'Amazon Prime', price: 90 },
                    netflix: {
                        id: 'netflix', name: 'Netflix', tiers: [
                            { id: 'netflix-anuncios', name: 'Netflix con Anuncios', price: 110 },
                            { id: 'netflix-estandar', name: 'Netflix Est√°ndar (2 pantallas)', price: 229 },
                            { id: 'netflix-premium', name: 'Netflix Premium (4 pantallas)', price: 299 },
                        ]
                    }
                },
                disney: {
                    id: 'disney', 
                    name: 'Disney+', 
                    tiers: [
                        { 
                            id: 'disney-estandar', 
                            name: 'Disney+ Est√°ndar', 
                            price: 249, 
                            description: 'Para 2 dispositivos a la vez sin publicidad' 
                        },
                        { 
                            id: 'disney-premium', 
                            name: 'Disney+ Premium', 
                            price: 319, 
                            description: 'Para 4 dispositivos a la vez sin publicidad' 
                        }
                    ]
                },
                app_packages: [
                    { id: 'paq-basico', name: 'Paquete 2 Apps B√°sicas', price: 199, limit: 2, apps: [ 'Amazon Prime', 'HBO con Anuncios', 'Paramount+' ] },
                    { id: 'paq-estandar-2', name: 'Paquete 2 Apps Est√°ndar', price: 399, limit: 2, apps: [ 'Fox Sports Premium', 'NBA League Pass', 'HBO MAX', 'Disney+ Est√°ndar' ] },
                    { id: 'paq-estandar-3', name: 'Paquete 3 Apps Est√°ndar', price: 599, limit: 3, apps: [ 'Fox Sports Premium', 'NBA League Pass', 'HBO MAX', 'Disney+ Est√°ndar' ] },
                ],
                devices: {
                    wifiPro: { id: 'wifi-pro', name: 'WifiPro', price: 69, tvOnly: false },
                    tvAdicional: { id: 'tv-adicional', name: 'TV Adicional', price: 129, tvOnly: true },
                    tvAdicionalAlexa: { id: 'tv-adicional-alexa', name: 'TV Adicional con Alexa', price: 280, tvOnly: true },
                    sonidoSurround: { id: 'sonido-surround', name: 'Sonido Surround', price: 199, tvOnly: true }
                }
            };
            
            // --- APPLICATION STATE ---
            let selection = {
                plan: null, 
                planType: 'combo', // Por defecto muestra Internet + TV
                giftOption: null,
                streaming: { service: null, tier: null, price: 0 },
                disney: { service: null, tier: null, price: 0 },
                appPackage: { data: null, selectedApps: [], price: 0 },
                devices: [], 
                total: 0,
                portability: false,
                installPrice: 350,
                portabilityDiscount: 0
            };

            // --- DOM ELEMENTS ---
            const dom = {
                planCardsContainer: document.getElementById('plan-cards-container'),
                giftSection: document.getElementById('gift-section'),
                giftOptionsContainer: document.getElementById('gift-options-container'),
                btnContinueGift: document.getElementById('btn-continue-gift'),
                addonsSection: document.getElementById('addons-section'),
                addonsIntro: document.getElementById('addons-intro'),
                addonsOptionsContainer: document.getElementById('addons-options'),
                contactSection: document.getElementById('contact-section'),
                contactForm: document.getElementById('contact-form'),
                btnContinue: document.getElementById('btn-continue'),
                formInputs: document.querySelectorAll('#contact-form input'),
                summaryContent: document.getElementById('summary-content'),
                summaryTotal: document.getElementById('summary-total'),
                summaryTotalDescription: document.getElementById('summary-total-description'),
                summaryInstall: document.getElementById('summary-install'),
                summaryInstallPrice: document.getElementById('summary-install-price'),
                continueText: document.getElementById('continue-text'),
                continueLoader: document.getElementById('continue-loader'),
                planTypeButtons: document.querySelectorAll('.plan-type-btn'),
                beneficiosSection: document.getElementById('beneficios'),
                testimoniosSection: document.getElementById('testimonios'),
                soporteSection: document.getElementById('soporte'),
                inicioSection: document.getElementById('inicio'),
                verPlanesBtn: document.getElementById('ver-planes-btn'),
                portabilityCheckbox: document.getElementById('portabilidad'),
                promocionesDirectasSection: document.getElementById('promociones-directas')
            };

            // --- FUNCTIONS ---

            function setPromoDate() {
                const today = new Date();
                document.getElementById('current-year').textContent = today.getFullYear();
                
                // Actualizar banner de promoci√≥n seg√∫n periodo
                const promoBanner = document.getElementById('promo-banner');
                if (isPromoPeriod()) {
                    promoBanner.innerHTML = '<p class="text-center font-bold text-[#00FFFF] text-lg">üéÅ ¬°OFERTAS ESPECIALES desde el 1 de noviembre hasta el 17 de noviembre 2025! Descuento por 5 meses + Netflix x 5 meses GRATIS</p>';
                }
            }

            function hideNonPlanSections() {
                // Ocultar secciones que no son relevantes para el proceso de contrataci√≥n
                dom.beneficiosSection.classList.add('section-hidden');
                dom.testimoniosSection.classList.add('section-hidden');
                dom.soporteSection.classList.add('section-hidden');
                dom.inicioSection.classList.add('fade-out');
                
                // Asegurarse de que las secciones de planes sean visibles
                document.getElementById('planes').classList.remove('section-hidden');
                document.getElementById('planes').scrollIntoView({ behavior: 'smooth' });
            }

            // Funci√≥n para determinar la clase de color seg√∫n los megas
            function getColorClass(megas) {
                switch(megas) {
                    case 100: return "plan-100";
                    case 200: return "plan-200";
                    case 300: return "plan-300";
                    case 500: return "plan-500";
                    case 1200: return "plan-1200";
                    case 5000: return "plan-5000";
                    case 10000: return "plan-10000";
                    default: return "plan-100";
                }
            }

            function renderPlanCards(type) {
                selection.planType = type;
                dom.planCardsContainer.innerHTML = '';
                const isPromoActive = isPromoPeriod();
                
                plansData[type].forEach(plan => {
                    const currentMegas = isPromoActive ? plan.promoMegas : plan.megas;
                    const colorClass = getColorClass(plan.megas);
                    
                    // Generar los beneficios formateados
                    const benefitsHTML = plan.formattedDesc.map(benefit => 
                        `<div class="benefit-item">${benefit}</div>`
                    ).join('');
                    
                    // Calcular precio despu√©s del 6to mes con descuento aplicado
                    const priceAfterDiscount = plan.promoPrice - plan.lifetimeDiscount;
                    
                    const card = `
                        <div class="card-hover p-6 rounded-2xl text-center flex flex-col relative h-full">
                            ${plan.recommended ? '<div class="recommended-badge">Recomendado</div>' : ''}
                            
                            <!-- Logo del Buen Mes en esquina superior izquierda -->
                            <img src="${BUEN_MES_LOGO_URL}" alt="Buen Mes" class="buen-mes-logo">
                            
                            <!-- T√≠tulo del plan con color espec√≠fico -->
                            <div class="${colorClass} p-4 rounded-xl text-center mb-4">
                                <h3 class="text-2xl font-bold">${plan.megas} MEGAS</h3>
                                <p class="font-semibold">${type === 'combo' ? 'Internet + TV' : 'Internet Sim√©trico'}</p>
                                ${plan.showExtraMegas ? `<div class="mt-2 text-sm font-bold">¬°NAVEGA CON ${currentMegas} MEGAS!</div>` : ''}
                                <div class="mt-2 flex items-center justify-center">
                                    <span class="gift-emoji">üéÅ</span>
                                    <span class="text-white text-sm ml-2">Contrata hoy y recibe un regalo de bienvenida</span>
                                </div>
                            </div>
                            
                            <!-- Descripci√≥n del plan formateada -->
                            <div class="text-left mb-4 flex-grow">
                                ${benefitsHTML}
                            </div>
                            
                            <!-- Detalles de descuentos -->
                            ${plan.lifetimeDiscount > 0 ? `
                                <div class="text-xs text-[#BDBDBD] mb-4">
                                    <div class="flex items-center justify-center">
                                        <span class="w-2 h-2 bg-[#00FFFF] rounded-full mr-2"></span>
                                        <span>Descuento de por vida: $${plan.lifetimeDiscount} (aplica al 6to mes)</span>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Precio - MEJORADO: Muestra precio durante 5 meses y despu√©s del 6to mes -->
                            <div class="my-6">
                                <div class="space-y-2">
                                    <div class="price-display">
                                        <div class="text-center">
                                            <span class="promo-price">$${plan.promoPrice}</span>
                                            <span class="regular-price">$${plan.regularPrice}</span>
                                        </div>
                                        <div class="price-description">Precio promoci√≥n al pagar puntual</div>
                                        <div class="price-after-discount">Durante los primeros 5 meses</div>
                                    </div>
                                    ${plan.lifetimeDiscount > 0 ? `
                                        <div class="text-center mt-4">
                                            <div class="text-sm text-[#BDBDBD]">Despu√©s del 6to mes:</div>
                                            <div class="text-lg font-bold text-[#00FFFF]">$${priceAfterDiscount}</div>
                                            <div class="text-xs text-[#BDBDBD]">(Descuento de por vida aplicado)</div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <button class="select-plan-btn mt-auto btn-buen-mes buen-mes-button py-3 px-6 rounded-full w-full"
                                data-megas="${plan.megas}" data-promo-megas="${currentMegas}" data-regular-price="${plan.regularPrice}" data-promo-price="${plan.promoPrice}" data-lifetime-discount="${plan.lifetimeDiscount}">
                                <span>Me interesa</span>
                            </button>
                        </div>
                    `;
                    dom.planCardsContainer.innerHTML += card;
                });
            }

            function renderGiftOptions(planMegas) {
                const options = giftOptions[planMegas] || giftOptions['100'];
                dom.giftOptionsContainer.innerHTML = '';
                
                options.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'gift-option';
                    optionElement.dataset.optionId = option.id;
                    
                    // Calcular precio final seg√∫n la opci√≥n seleccionada
                    let finalPrice = selection.plan.promoPrice - option.discount;
                    let priceAfterDiscount = selection.plan.promoPrice - selection.plan.lifetimeDiscount;
                    
                    // Para la opci√≥n 2 con Netflix, el precio despu√©s del 6to mes es mayor
                    if (option.netflix) {
                        priceAfterDiscount = selection.plan.promoPrice - selection.plan.lifetimeDiscount + option.netflixPrice;
                    }
                    
                    optionElement.innerHTML = `
                        <div class="flex items-center">
                            <input type="radio" name="gift-option" id="${option.id}" class="custom-radio mr-4">
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-white">${option.title}</h3>
                                <p class="text-[#BDBDBD] mt-2">${option.description}</p>
                                <div class="mt-4">
                                    <p class="text-[#BDBDBD]">Precio mensual por ${option.months} meses:</p>
                                    <p class="gift-price">$${finalPrice}</p>
                                    <p class="gift-price-small">despu√©s del 6to mes $${priceAfterDiscount} (Descuento de por vida aplicado)</p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    dom.giftOptionsContainer.appendChild(optionElement);
                    
                    // A√±adir evento de selecci√≥n
                    optionElement.addEventListener('click', () => {
                        document.querySelectorAll('.gift-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        optionElement.classList.add('selected');
                        document.getElementById(option.id).checked = true;
                        selection.giftOption = option;
                    });
                });
                
                // Mostrar secci√≥n de regalos
                dom.giftSection.classList.remove('hidden');
                dom.giftSection.scrollIntoView({ behavior: 'smooth' });
            }

            function renderAddonsOptions() {
                const { streaming, disney, app_packages, devices } = addonsData;
                const isTvPlan = selection.planType === 'combo';
                
                let streamingOptions = `
                    <label class="flex items-center p-3 bg-[#0f0f0f] rounded-lg has-[:checked]:bg-[#2962FF]/20 border-2 border-transparent has-[:checked]:border-[#2962FF]">
                        <input type="radio" name="streaming" value="none" class="custom-radio" checked> 
                        <span class="ml-3 text-[#BDBDBD]">Ninguno</span>
                    </label>
                    <label class="flex items-center p-3 bg-[#0f0f0f] rounded-lg has-[:checked]:bg-[#2962FF]/20 border-2 border-transparent has-[:checked]:border-[#2962FF]">
                        <input type="radio" name="streaming" value="prime" class="custom-radio"> 
                        <span class="ml-3 text-[#BDBDBD]">${streaming.prime.name} (+$${streaming.prime.price})</span>
                    </label>
                    <label class="flex items-center p-3 bg-[#0f0f0f] rounded-lg has-[:checked]:bg-[#2962FF]/20 border-2 border-transparent has-[:checked]:border-[#2962FF]">
                        <input type="radio" name="streaming" value="netflix" class="custom-radio"> 
                        <span class="ml-3 text-[#BDBDBD]">${streaming.netflix.name}</span>
                    </label>`;
                
                let netflixTiers = '';
                streaming.netflix.tiers.forEach(tier => {
                    netflixTiers += `
                        <label class="flex items-center p-3 bg-[#0f0f0f] rounded-lg has-[:checked]:bg-[#2962FF]/20 border-2 border-transparent has-[:checked]:border-[#2962FF]">
                            <input type="radio" name="netflix-tier" value="${tier.id}" class="custom-radio"> 
                            <span class="ml-3 text-[#BDBDBD]">${tier.name} (+$${tier.price})</span>
                        </label>`;
                });
                
                let disneyOptions = `
                    <label class="flex items-center p-3 bg-[#0f0f0f] rounded-lg has-[:checked]:bg-[#2962FF]/20 border-2 border-transparent has-[:checked]:border-[#2962FF]">
                        <input type="radio" name="disney" value="none" class="custom-radio" checked> 
                        <span class="ml-3 text-[#BDBDBD]">Ninguno</span>
                    </label>`;
                
                disney.tiers.forEach(tier => {
                    disneyOptions += `
                        <label class="flex items-center p-3 bg-[#0f0f0f] rounded-lg has-[:checked]:bg-[#2962FF]/20 border-2 border-transparent has-[:checked]:border-[#2962FF]">
                            <input type="radio" name="disney" value="${tier.id}" class="custom-radio"> 
                            <span class="ml-3 text-[#BDBDBD]">${tier.name} (+$${tier.price})</span>
                        </label>
                        <div class="disney-promo p-3 rounded-lg mb-3 ml-6">
                            <p class="text-sm text-white">${tier.description}</p>
                        </div>`;
                });
                
                let appPackageOptions = '';
                app_packages.forEach(pkg => {
                    appPackageOptions += `
                        <label class="flex items-center p-3 bg-[#0f0f0f] rounded-lg has-[:checked]:bg-[#2962FF]/20 border-2 border-transparent has-[:checked]:border-[#2962FF]">
                            <input type="radio" name="app-package" value="${pkg.id}" class="custom-radio">
                            <span class="ml-3 text-[#BDBDBD]">${pkg.name} (+$${pkg.price})</span>
                        </label>`;
                });
                
                let deviceOptions = '';
                Object.values(devices).forEach(device => {
                    if (!device.tvOnly || isTvPlan) {
                        deviceOptions += `
                            <label class="flex items-center p-3 bg-[#0f0f0f] rounded-lg has-[:checked]:bg-[#2962FF]/20 border-2 border-transparent has-[:checked]:border-[#2962FF]">
                                <input type="checkbox" name="device" value="${device.id}" class="custom-checkbox"> 
                                <span class="ml-3 text-[#BDBDBD]">${device.name} (+$${device.price})</span>
                            </label>`;
                    }
                });
                
                dom.addonsOptionsContainer.innerHTML = `
                    <div class="bg-[#1a1a1a] p-6 rounded-2xl border border-[#424242]">
                        <h3 class="text-xl font-bold mb-4 accent-text">1. Elige una plataforma de Streaming (opcional)</h3>
                        <div class="space-y-3" id="streaming-choice">
                            ${streamingOptions}
                        </div>
                        <div id="netflix-tiers" class="hidden mt-4 ml-6 space-y-3 border-l-2 border-[#424242] pl-6">
                            ${netflixTiers}
                        </div>
                    </div>
                    <div class="bg-[#1a1a1a] p-6 rounded-2xl border border-[#424242]">
                        <h3 class="text-xl font-bold mb-4 accent-text">2. Elige Disney+ (opcional)</h3>
                        <div class="space-y-3" id="disney-choice">
                            ${disneyOptions}
                        </div>
                    </div>
                    <div class="bg-[#1a1a1a] p-6 rounded-2xl border border-[#424242]">
                        <h3 class="text-xl font-bold mb-4 accent-text">3. Elige un paquete de Apps (opcional)</h3>
                        <div class="space-y-3" id="package-choice">
                            <label class="flex items-center p-3 bg-[#0f0f0f] rounded-lg has-[:checked]:bg-[#2962FF]/20 border-2 border-transparent has-[:checked]:border-[#2962FF]">
                                <input type="radio" name="app-package" value="none" class="custom-radio" checked> 
                                <span class="ml-3 text-[#BDBDBD]">Ninguno</span>
                            </label>
                            ${appPackageOptions}
                        </div>
                        <div id="package-apps-container" class="mt-4"></div>
                    </div>
                    <div class="bg-[#1a1a1a] p-6 rounded-2xl border border-[#424242]">
                        <h3 class="text-xl font-bold mb-4 accent-text">4. Agrega Dispositivos (opcional)</h3>
                        <div class="space-y-3" id="device-choice">
                            ${deviceOptions}
                        </div>
                    </div>`;
                
                dom.addonsOptionsContainer.classList.remove('hidden');
                
                // Ocultar opci√≥n de portabilidad si no est√° en periodo promocional
                if (!isPromoPeriod()) {
                    const portabilityLabel = document.querySelector('label[for="portabilidad"]');
                    if (portabilityLabel) {
                        portabilityLabel.style.display = 'none';
                    }
                    const portabilityCheckbox = document.getElementById('portabilidad');
                    if (portabilityCheckbox) {
                        portabilityCheckbox.style.display = 'none';
                    }
                }
            }

            function renderPackageApps(packageId) {
                const container = document.getElementById('package-apps-container');
                const pkg = addonsData.app_packages.find(p => p.id === packageId);
                if (!pkg) { 
                    container.innerHTML = ''; 
                    return; 
                }
                
                const primeSelected = selection.streaming.service === addonsData.streaming.prime.name;
                const disneySelected = selection.disney.service !== null;
                
                let appOptions = '';
                pkg.apps.forEach(app => {
                    const isPermanentlyDisabled = (app === 'Amazon Prime' && primeSelected) || (app === 'Disney+ Est√°ndar' && disneySelected);
                    appOptions += `
                        <label class="flex items-center p-2 rounded-md transition-opacity ${isPermanentlyDisabled ? 'opacity-50 cursor-not-allowed' : 'hover:bg-[#0f0f0f]'}">
                            <input type="checkbox" name="package-app" value="${app}" class="custom-checkbox" 
                                ${isPermanentlyDisabled ? 'disabled data-permanently-disabled="true"' : ''}> 
                            <span class="ml-3 text-[#BDBDBD]">${app}</span>
                        </label>`;
                });
                
                container.innerHTML = `
                    <div class="ml-6 border-l-2 border-[#424242] pl-6 space-y-3">
                        <div class="flex justify-between items-center">
                            <p class="package-selection-counter font-semibold text-[#BDBDBD]">Selecciona hasta ${pkg.limit} app${pkg.limit !== 1 ? 's' : ''}: (0/${pkg.limit})</p>
                            <p class="package-limit-message text-[#00FFFF] text-sm font-semibold hidden">¬°L√≠mite alcanzado!</p>
                        </div>
                        <div class="limited-checkbox-group grid sm:grid-cols-2 gap-2" data-limit="${pkg.limit}">
                            ${appOptions}
                        </div>
                    </div>`;
            }

            function updateSummaryAndTotal() {
                if (!selection.plan) return;
                
                // Calcular precio con descuento del regalo
                let planPrice = selection.plan.promoPrice;
                if (selection.giftOption) {
                    planPrice = selection.plan.promoPrice - selection.giftOption.discount;
                }
                
                let total = planPrice;
                let summaryHTML = `
                    <div class="space-y-3">
                        <p class="text-[#BDBDBD]"><strong>Servicio:</strong> ${selection.planType === 'internet' ? 'Solo Internet' : 'Internet + TV'}</p>
                        <p class="text-[#BDBDBD]"><strong>Plan:</strong> ${selection.plan.megas} MEGAS</p>
                        <p class="text-[#BDBDBD]"><strong>Precio Plan:</strong> $${selection.plan.promoPrice}</p>`;
                
                // A√±adir informaci√≥n del regalo seleccionado - SIEMPRE que exista
                if (selection.giftOption) {
                    summaryHTML += `<p class="text-[#00FFFF]"><strong>Opci√≥n de Regalo:</strong> ${selection.giftOption.description}</p>`;
                }
                
                let addonsSummary = '';
                
                if (selection.streaming.price > 0) {
                    addonsSummary += `<li class="text-[#BDBDBD]">${selection.streaming.tier ? `${selection.streaming.service} (${selection.streaming.tier})` : selection.streaming.service}: +$${selection.streaming.price}</li>`;
                    total += selection.streaming.price;
                }
                
                if (selection.disney.price > 0) {
                    addonsSummary += `<li class="text-[#BDBDBD]">${selection.disney.tier ? `${selection.disney.service} (${selection.disney.tier})` : selection.disney.service}: +$${selection.disney.price}</li>`;
                    total += selection.disney.price;
                }
                
                if (selection.appPackage.price > 0) {
                    addonsSummary += `<li class="text-[#BDBDBD]">${selection.appPackage.data.name}: +$${selection.appPackage.price}</li>`;
                    total += selection.appPackage.price;
                    
                    if (selection.appPackage.selectedApps.length > 0) {
                        addonsSummary += `<ul class="list-disc list-inside ml-4 text-[#00FFFF]">`;
                        selection.appPackage.selectedApps.forEach(app => {
                            addonsSummary += `<li class="text-[#00FFFF]">${app}</li>`;
                        });
                        addonsSummary += `</ul>`;
                    }
                }
                
                if (selection.devices.length > 0) {
                    selection.devices.forEach(device => {
                        addonsSummary += `<li class="text-[#BDBDBD]">${device.name}: +$${device.price}</li>`;
                        total += device.price;
                    });
                }
                
                if (addonsSummary) {
                    summaryHTML += `
                        <div class="border-t border-[#424242] my-2 pt-2">
                            <p class="text-[#BDBDBD]"><strong>Adicionales:</strong></p>
                            <ul class="list-none space-y-1">
                                ${addonsSummary}
                            </ul>
                        </div>`;
                }
                
                summaryHTML += `</div>`;
                
                // Calcular descuento por portabilidad (solo en periodo promocional)
                selection.portabilityDiscount = selection.portability && isPromoPeriod() ? portabilityDiscount[selection.planType] : 0;
                
                selection.total = total;
                
                // Pago inicial es el total mensual (la instalaci√≥n es $0)
                selection.installPrice = selection.total;
                
                dom.summaryContent.innerHTML = summaryHTML;
                dom.summaryTotal.textContent = `$${selection.total}`;
                
                // Actualizar descripci√≥n del total seg√∫n la opci√≥n de regalo
                let totalDescription = '';
                if (selection.giftOption) {
                    totalDescription = `$${selection.total} mensual por ${selection.giftOption.months} meses`;
                } else {
                    totalDescription = `$${selection.total} mensual`;
                }
                dom.summaryTotalDescription.textContent = totalDescription;
                
                dom.summaryInstall.textContent = `$0 (Valor $350)`;
                dom.summaryInstallPrice.textContent = `$${selection.installPrice}`;
            }
            
            function handlePlanSelection(e) {
                if (!e.target.classList.contains('select-plan-btn')) return;
                
                const { megas, promoMegas, regularPrice, promoPrice, lifetimeDiscount } = e.target.dataset;
                selection.plan = { 
                    megas: parseInt(megas), 
                    promoMegas: parseInt(promoMegas),
                    regularPrice: parseInt(regularPrice),
                    promoPrice: parseInt(promoPrice),
                    lifetimeDiscount: parseInt(lifetimeDiscount)
                };
                
                // Track event for Facebook Pixel - AddToCart
                trackFacebookEvent('AddToCart', {
                    content_name: `Plan ${selection.plan.megas} Megas - ${selection.planType}`,
                    content_ids: [`plan_${selection.planType}_${selection.plan.megas}`],
                    content_type: 'product',
                    value: selection.plan.promoPrice,
                    currency: 'MXN'
                });
                
                // Ocultar secciones no relevantes
                hideNonPlanSections();
                
                document.querySelector('#planes .text-center > .promo-gradient').classList.add('hidden');
                dom.planCardsContainer.classList.add('hidden');
                document.getElementById('plan-type-buttons').classList.add('hidden');
                
                // Mostrar opciones de regalo
                renderGiftOptions(selection.plan.megas);
                
                updateSummaryAndTotal();
            }

            function handleAddonsEvents(e) {
                const { name, value, type } = e.target;
                
                if (name === 'streaming') {
                    const netflixTiers = document.getElementById('netflix-tiers');
                    selection.streaming = { service: null, tier: null, price: 0 };
                    
                    if (netflixTiers) {
                        Array.from(netflixTiers.querySelectorAll('input')).forEach(i => i.checked = false);
                    }
                    
                    if (value === 'prime') {
                        selection.streaming = { 
                            service: addonsData.streaming.prime.name, 
                            tier: null, 
                            price: addonsData.streaming.prime.price 
                        };
                    } else if (value === 'netflix') {
                        if (netflixTiers) netflixTiers.classList.remove('hidden');
                    } else {
                        if (netflixTiers) netflixTiers.classList.add('hidden');
                    }
                    
                    if (selection.appPackage.data) {
                        renderPackageApps(selection.appPackage.data.id);
                    }
                }
                
                if (name === 'netflix-tier') {
                    const tierData = addonsData.streaming.netflix.tiers.find(t => t.id === value);
                    selection.streaming = { 
                        service: addonsData.streaming.netflix.name, 
                        tier: tierData.name, 
                        price: tierData.price 
                    };
                }
                
                if (name === 'disney') {
                    selection.disney = { service: null, tier: null, price: 0 };
                    
                    if (value !== 'none') {
                        const tierData = addonsData.disney.tiers.find(t => t.id === value);
                        selection.disney = { 
                            service: addonsData.disney.name, 
                            tier: tierData.name, 
                            price: tierData.price 
                        };
                        
                        // Si selecciona Disney+, verificar si hay Disney+ en paquete de apps y desmarcarlo
                        if (selection.appPackage.data && selection.appPackage.selectedApps.includes('Disney+ Est√°ndar')) {
                            const index = selection.appPackage.selectedApps.indexOf('Disney+ Est√°ndar');
                            if (index > -1) {
                                selection.appPackage.selectedApps.splice(index, 1);
                                
                                // Actualizar checkboxes en la UI
                                const checkboxes = document.querySelectorAll('input[name="package-app"]');
                                checkboxes.forEach(cb => {
                                    if (cb.value === 'Disney+ Est√°ndar') {
                                        cb.checked = false;
                                    }
                                });
                                
                                // Actualizar contador
                                const group = document.querySelector('.limited-checkbox-group');
                                if (group) {
                                    const limit = parseInt(group.dataset.limit);
                                    const checkedCheckboxes = group.querySelectorAll('input[name="package-app"]:checked');
                                    const counterElement = group.parentElement.querySelector('.package-selection-counter');
                                    const messageElement = group.parentElement.querySelector('.package-limit-message');
                                    
                                    if (counterElement) {
                                        counterElement.textContent = `Selecciona hasta ${limit} app${limit !== 1 ? 's' : ''}: (${checkedCheckboxes.length}/${limit})`;
                                    }
                                    
                                    if (checkedCheckboxes.length < limit && messageElement) {
                                        messageElement.classList.add('hidden');
                                        group.querySelectorAll('input[name="package-app"]').forEach(cb => {
                                            if (cb.dataset.permanentlyDisabled !== 'true') {
                                                cb.disabled = false;
                                                cb.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
                                            }
                                        });
                                    }
                                }
                            }
                        }
                    }
                    
                    if (selection.appPackage.data) {
                        renderPackageApps(selection.appPackage.data.id);
                    }
                }
                
                if (name === 'app-package') {
                    selection.appPackage = { data: null, selectedApps: [], price: 0 };
                    
                    if (value !== 'none') {
                        const pkg = addonsData.app_packages.find(p => p.id === value);
                        selection.appPackage = { 
                            data: pkg, 
                            selectedApps: [], 
                            price: pkg.price 
                        };
                        
                        // Si selecciona un paquete que incluye Disney+ y ya tiene Disney+ seleccionado, desmarcar Disney+
                        if (pkg.apps.includes('Disney+ Est√°ndar') && selection.disney.service !== null) {
                            selection.disney = { service: null, tier: null, price: 0 };
                            
                            // Actualizar radio buttons de Disney en la UI
                            const disneyRadios = document.querySelectorAll('input[name="disney"]');
                            disneyRadios.forEach(radio => {
                                if (radio.value === 'none') {
                                    radio.checked = true;
                                } else {
                                    radio.checked = false;
                                }
                            });
                        }
                    } 
                    renderPackageApps(value);
                }
                
                if (name === 'package-app') {
                    const group = e.target.closest('.limited-checkbox-group');
                    if (!group) return;
                    
                    const limit = parseInt(group.dataset.limit);
                    const allCheckboxes = group.querySelectorAll('input[name="package-app"]');
                    const messageElement = group.parentElement.querySelector('.package-limit-message');
                    const counterElement = group.parentElement.querySelector('.package-selection-counter');
                    
                    const checkedCheckboxes = group.querySelectorAll('input[name="package-app"]:checked');
                    selection.appPackage.selectedApps = Array.from(checkedCheckboxes).map(cb => cb.value);
                    
                    if (counterElement) {
                        counterElement.textContent = `Selecciona hasta ${limit} app${limit !== 1 ? 's' : ''}: (${checkedCheckboxes.length}/${limit})`;
                    }
                    
                    // Si selecciona Disney+ en el paquete de apps, desmarcar Disney+ promocional
                    if (e.target.checked && e.target.value === 'Disney+ Est√°ndar' && selection.disney.service !== null) {
                        selection.disney = { service: null, tier: null, price: 0 };
                        
                        // Actualizar radio buttons de Disney en la UI
                        const disneyRadios = document.querySelectorAll('input[name="disney"]');
                        disneyRadios.forEach(radio => {
                            if (radio.value === 'none') {
                                radio.checked = true;
                            } else {
                                radio.checked = false;
                            }
                        });
                    }
                    
                    if (checkedCheckboxes.length >= limit) {
                        if (messageElement) messageElement.classList.remove('hidden');
                        
                        allCheckboxes.forEach(cb => {
                            if (!cb.checked) {
                                cb.disabled = true;
                                cb.parentElement.classList.add('opacity-50', 'cursor-not-allowed');
                            }
                        });
                    } else {
                        if (messageElement) messageElement.classList.add('hidden');
                        
                        allCheckboxes.forEach(cb => {
                            if (cb.dataset.permanentlyDisabled !== 'true') {
                                cb.disabled = false;
                                cb.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
                            }
                        });
                    }
                }
                
                if (name === 'device') {
                    selection.devices = Array.from(document.querySelectorAll('input[name="device"]:checked'))
                        .map(cb => Object.values(addonsData.devices).find(d => d.id === cb.value))
                        .filter(Boolean);
                }
                
                updateSummaryAndTotal();
            }

            function validateForm() {
                const isValid = Array.from(dom.formInputs).every(input => input.checkValidity());
                dom.btnContinue.disabled = !isValid;
            }

            // Funci√≥n para formatear los adicionales como texto
            function formatAdicionales() {
                let adicionalesText = '';
                
                if (selection.streaming.price > 0) {
                    adicionalesText += `Streaming: ${selection.streaming.tier ? `${selection.streaming.service} (${selection.streaming.tier})` : selection.streaming.service}`;
                }
                
                if (selection.disney.price > 0) {
                    if (adicionalesText) adicionalesText += ' | ';
                    adicionalesText += `Disney+: ${selection.disney.tier}`;
                }
                
                if (selection.appPackage.price > 0) {
                    if (adicionalesText) adicionalesText += ' | ';
                    adicionalesText += `Paquete Apps: ${selection.appPackage.data.name}`;
                    if (selection.appPackage.selectedApps.length > 0) {
                        adicionalesText += ` (${selection.appPackage.selectedApps.join(', ')})`;
                    }
                }
                
                if (selection.devices.length > 0) {
                    if (adicionalesText) adicionalesText += ' | ';
                    adicionalesText += `Dispositivos: ${selection.devices.map(d => d.name).join(', ')}`;
                }
                
                return adicionalesText || 'Ninguno';
            }

            // Funci√≥n para crear el resumen completo
            function crearResumenCompleto() {
                // Calcular precio con descuento del regalo
                let planPrice = selection.plan.promoPrice;
                if (selection.giftOption) {
                    planPrice = selection.plan.promoPrice - selection.giftOption.discount;
                }
                
                let resumen = `SERVICIO: ${selection.planType === 'internet' ? 'Solo Internet' : 'Internet + TV'}\n`;
                resumen += `PLAN: ${selection.plan.megas} MEGAS\n`;
                resumen += `PRECIO PLAN: $${selection.plan.promoPrice}\n`;
                
                // A√±adir informaci√≥n del regalo seleccionado - SIEMPRE que exista
                if (selection.giftOption) {
                    resumen += `OPCI√ìN DE REGALO: ${selection.giftOption.description}\n`;
                }
                
                resumen += `\nTOTAL MENSUAL: $${selection.total}\n`;
                
                if (selection.streaming.price > 0 || selection.disney.price > 0 || selection.appPackage.price > 0 || selection.devices.length > 0) {
                    resumen += `\nADICIONALES:\n`;
                    
                    if (selection.streaming.price > 0) {
                        resumen += `- ${selection.streaming.tier ? `${selection.streaming.service} (${selection.streaming.tier})` : selection.streaming.service}: $${selection.streaming.price}/mes\n`;
                    }
                    
                    if (selection.disney.price > 0) {
                        resumen += `- ${selection.disney.tier ? `${selection.disney.service} (${selection.disney.tier})` : selection.disney.service}: $${selection.disney.price}/mes\n`;
                    }
                    
                    if (selection.appPackage.price > 0) {
                        resumen += `- ${selection.appPackage.data.name}: $${selection.appPackage.price}/mes\n`;
                        if (selection.appPackage.selectedApps.length > 0) {
                            selection.appPackage.selectedApps.forEach(app => {
                                resumen += `  * ${app}\n`;
                            });
                        }
                    }
                    
                    if (selection.devices.length > 0) {
                        selection.devices.forEach(device => {
                            resumen += `- ${device.name}: $${device.price}/mes\n`;
                        });
                    }
                }
                
                resumen += `\nCOSTO DE INSTALACI√ìN EXTRA: $0 (Valor $350)\n`;
                
                if (selection.portability && isPromoPeriod()) {
                    const discountAmount = portabilityDiscount[selection.planType];
                    resumen += `DESEO HACER PORTABILIDAD PARA EL DESCUENTO DE: $${discountAmount} EN MI SEGUNDA MENSUALIDAD\n`;
                }
                
                resumen += `PAGO INICIAL: $${selection.installPrice}\n`;
                resumen += `FECHA: ${new Date().toLocaleString('es-MX')}`;
                
                return resumen;
            }

            async function sendDataToMake(formData) {
                try {
                    // Preparar datos para Google Sheets seg√∫n las columnas especificadas
                    const sheetsData = {
                        nombre: formData.nombre,
                        correo: formData.correo,
                        telefono: formData.telefono,
                        servicio: formData.servicio,
                        plan: formData.plan,
                        adicionales: formatAdicionales(),
                        opcion_regalo: selection.giftOption ? selection.giftOption.description : 'Ninguna',
                        total_mensual: formData.total,
                        pago_inicial: formData.installPrice,
                        fecha: new Date().toLocaleString('es-MX'),
                        resumen: crearResumenCompleto()
                    };
                    
                    // Enviar datos a Make.com
                    const response = await fetch(MAKE_WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(sheetsData),
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Error enviando datos a Make.com:', error);
                    return null;
                }
            }

            async function submitAndRedirect() {
                // Validar que el formulario est√© completo antes de proceder
                const isFormValid = Array.from(dom.formInputs).every(input => input.checkValidity());
                if (!isFormValid) {
                    alert('Por favor completa todos los campos requeridos antes de continuar.');
                    return;
                }
                
                dom.continueText.classList.add('hidden');
                dom.continueLoader.classList.remove('hidden');
                dom.btnContinue.disabled = true;
                
                // A√±adir clase de loading al formulario
                dom.contactForm.classList.add('form-loading');

                // Calcular precio con descuento del regalo
                let planPrice = selection.plan.promoPrice;
                if (selection.giftOption) {
                    planPrice = selection.plan.promoPrice - selection.giftOption.discount;
                }

                const formData = {
                    nombre: document.getElementById('nombre').value,
                    correo: document.getElementById('correo').value,
                    telefono: document.getElementById('telefono').value,
                    servicio: selection.planType === 'internet' ? 'Solo Internet' : 'Internet + TV',
                    plan: `${selection.plan.megas} MEGAS`,
                    precio_plan: planPrice,
                    adicionales: {
                        streaming: selection.streaming.service ? {
                            servicio: selection.streaming.service,
                            plan: selection.streaming.tier,
                            precio: selection.streaming.price
                        } : null,
                        disney: selection.disney.service ? {
                            servicio: selection.disney.service,
                            plan: selection.disney.tier,
                            precio: selection.disney.price
                        } : null,
                        paquete_apps: selection.appPackage.data ? {
                            nombre: selection.appPackage.data.name,
                            apps_seleccionadas: selection.appPackage.selectedApps,
                            precio: selection.appPackage.price
                        } : null,
                        dispositivos: selection.devices.length > 0 ? selection.devices.map(d => ({
                            nombre: d.name,
                            precio: d.price
                        })) : []
                    },
                    total: selection.total,
                    installPrice: selection.installPrice,
                    portability: selection.portability,
                    portabilityDiscount: selection.portabilityDiscount
                };

                // Track event for Facebook Pixel - Lead
                trackFacebookEvent('Lead', {
                    value: selection.total,
                    currency: 'MXN'
                });

                // Enviar datos a Make.com (en segundo plano, no esperamos la respuesta)
                sendDataToMake(formData).then(result => {
                    console.log('Datos enviados a Make.com:', result);
                }).catch(error => {
                    console.error('Error enviando a Make.com:', error);
                });

                // Construir mensaje para WhatsApp
                let message = `Hola, mi nombre es ${formData.nombre}.\n\nQuiero contratar el siguiente paquete:\n`;
                message += `*Servicio:* ${formData.servicio}\n`;
                message += `*Plan:* ${formData.plan}\n`;
                message += `*Precio Plan:* $${formData.precio_plan}\n`;
                
                // A√±adir informaci√≥n del regalo seleccionado
                if (selection.giftOption) {
                    message += `*Opci√≥n de Regalo:* ${selection.giftOption.description}\n`;
                }
                
                message += `\n*Total Mensual:*\n`;
                message += `*$${formData.total} mensual por ${selection.giftOption ? selection.giftOption.months : '1'} ${selection.giftOption && selection.giftOption.months > 1 ? 'meses' : 'mes'}*\n\n`;
                
                if (formData.adicionales.streaming || formData.adicionales.disney || formData.adicionales.paquete_apps || formData.adicionales.dispositivos.length > 0) {
                    message += "*Adicionales:*\n";
                    
                    if (formData.adicionales.streaming) {
                        message += `- ${formData.adicionales.streaming.servicio}${formData.adicionales.streaming.plan ? ` (${formData.adicionales.streaming.plan})` : ''}: $${formData.adicionales.streaming.precio}\n`;
                    }
                    
                    if (formData.adicionales.disney) {
                        message += `- ${formData.adicionales.disney.servicio}${formData.adicionales.disney.plan ? ` (${formData.adicionales.disney.plan})` : ''}: $${formData.adicionales.disney.precio}\n`;
                    }
                    
                    if (formData.adicionales.paquete_apps) {
                        message += `- ${formData.adicionales.paquete_apps.nombre}: $${formData.adicionales.paquete_apps.precio}\n`;
                        if (formData.adicionales.paquete_apps.apps_seleccionadas.length > 0) {
                            formData.adicionales.paquete_apps.apps_seleccionadas.forEach(app => {
                                message += `  - ${app}\n`;
                            });
                        }
                    }
                    
                    if (formData.adicionales.dispositivos.length > 0) {
                        formData.adicionales.dispositivos.forEach(d => {
                            message += `- ${d.nombre}: $${d.precio}\n`;
                        });
                    }
                    
                    message += "\n";
                }
                
                message += `*Costo de Instalaci√≥n Extra:* *$0 (Valor $350)*\n`;
                
                if (formData.portability && isPromoPeriod()) {
                    message += `*Deseo hacer portabilidad para el descuento de: $${formData.portabilityDiscount} en mi segunda mensualidad*\n`;
                }
                
                message += `\n*Pago Inicial:* *$${formData.installPrice}*\n\n`;
                message += `*Mis datos de contacto son:*\nCorreo: ${formData.correo}\nTel√©fono: ${formData.telefono}`;
                
                // Redirigir a WhatsApp
                const whatsappURL = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
                window.location.href = whatsappURL;
            }

            // Funci√≥n para manejar la contrataci√≥n directa desde las nuevas promociones
            function handleDirectPromoContract(e) {
                if (!e.target.classList.contains('contratar-directo-btn')) return;
                
                const { plan, price, megas, promoMegas } = e.target.dataset;
                
                // Configurar la selecci√≥n para la promoci√≥n directa
                selection.plan = {
                    megas: parseInt(megas),
                    promoMegas: parseInt(promoMegas),
                    regularPrice: parseInt(price),
                    promoPrice: parseInt(price),
                    lifetimeDiscount: 0
                };
                
                selection.planType = plan.includes('Solo Internet') ? 'internet' : 'combo';
                selection.giftOption = null; // No hay regalos en estas promociones
                
                // Track event for Facebook Pixel - AddToCart
                trackFacebookEvent('AddToCart', {
                    content_name: `Promoci√≥n Directa - ${plan}`,
                    content_ids: [`direct_promo_${selection.planType}_${megas}`],
                    content_type: 'product',
                    value: parseInt(price),
                    currency: 'MXN'
                });
                
                // Ocultar secciones no relevantes
                hideNonPlanSections();
                dom.promocionesDirectasSection.classList.add('hidden');
                
                // Ir directamente al formulario de contacto
                dom.contactSection.classList.remove('hidden');
                dom.contactSection.scrollIntoView({ behavior: 'smooth' });
                
                // Actualizar el resumen
                updateSummaryAndTotal();
            }

            // --- EVENT LISTENERS ---
            
            dom.planTypeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    dom.planTypeButtons.forEach(btn => {
                        btn.classList.remove('bg-[#2962FF]');
                        btn.classList.add('bg-transparent', 'hover:bg-[#424242]');
                    });
                    button.classList.add('bg-[#2962FF]');
                    button.classList.remove('bg-transparent', 'hover:bg-[#424242]');
                    renderPlanCards(button.id.replace('btn-', ''));
                });
            });
            
            dom.planCardsContainer.addEventListener('click', handlePlanSelection);
            
            // Event listener para los botones de contrataci√≥n directa
            document.addEventListener('click', handleDirectPromoContract);
            
            // Event listener para continuar despu√©s de seleccionar regalo
            dom.btnContinueGift.addEventListener('click', () => {
                if (!selection.giftOption) {
                    alert('Por favor selecciona una opci√≥n de regalo antes de continuar.');
                    return;
                }
                
                dom.giftSection.classList.add('hidden');
                dom.addonsSection.classList.remove('hidden');
                dom.addonsSection.scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('btn-addons-yes').addEventListener('click', () => {
                // Track Personalizar producto event
                trackFacebookEvent('Personalizar producto', {
                    content_name: 'Add-ons Selection',
                    content_category: 'Customization'
                });
                
                dom.addonsIntro.classList.add('hidden');
                renderAddonsOptions();
                dom.contactSection.classList.remove('hidden');
                dom.addonsOptionsContainer.scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('btn-addons-no').addEventListener('click', () => {
                // Track event for Facebook Pixel - SkipAddons
                trackFacebookEvent('SkipAddons', {
                    content_name: 'No Additional Services',
                    content_category: 'Customization'
                });
                
                dom.addonsSection.classList.add('hidden');
                dom.contactSection.classList.remove('hidden');
                dom.contactSection.scrollIntoView({ behavior: 'smooth' });
                
                // Asegurarse de que el resumen se actualice para mostrar el regalo
                updateSummaryAndTotal();
            });

            dom.addonsOptionsContainer.addEventListener('change', handleAddonsEvents);
            dom.formInputs.forEach(input => input.addEventListener('input', validateForm));
            dom.btnContinue.addEventListener('click', submitAndRedirect);
            
            // Event listener para el checkbox de portabilidad
            dom.portabilityCheckbox.addEventListener('change', function() {
                selection.portability = this.checked;
                updateSummaryAndTotal();
            });
            
            // Event listener para el bot√≥n "Ver Planes"
            dom.verPlanesBtn.addEventListener('click', function(e) {
                e.preventDefault();
                hideNonPlanSections();
                document.getElementById('planes').scrollIntoView({ behavior: 'smooth' });
            });

            // --- INICIALIZACI√ìN ---
            setPromoDate();
            
            // Inicializar los planes al cargar la p√°gina
            // Por defecto muestra los planes de Internet + TV
            renderPlanCards('combo');
            
            // Asegurarse de que el bot√≥n de Internet + TV est√© activo
            document.getElementById('btn-combo').classList.add('bg-[#2962FF]');
            document.getElementById('btn-combo').classList.remove('bg-transparent', 'hover:bg-[#424242]');
            document.getElementById('btn-internet').classList.remove('bg-[#2962FF]');
            document.getElementById('btn-internet').classList.add('bg-transparent', 'hover:bg-[#424242]');
        });
    </script>
</body>
</html>