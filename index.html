<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesor Juan Mel√©ndez - Contrata Totalplay Fibra √ìptica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1766933083922039');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1766933083922039&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            overflow-x: hidden;
        }
        .halloween-gradient {
            background: linear-gradient(135deg, #1a0b0b 0%, #2d1a1a 50%, #1a0b0b 100%);
            position: relative;
            overflow: hidden;
        }
        .halloween-gradient::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 140, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 69, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(139, 0, 0, 0.1) 0%, transparent 50%);
            z-index: 1;
        }
        .halloween-text {
            background: linear-gradient(45deg, #ff8c00, #ff4500, #ff8c00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .promo-gradient {
            background: linear-gradient(45deg, #ff8c00, #ff4500);
        }
        .custom-checkbox:checked, .custom-radio:checked {
            background-color: #ff8c00;
            border-color: #ff4500;
        }
        .fade-out {
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: opacity 0.5s ease, height 0.5s ease;
        }
        .fade-in {
            opacity: 1;
            height: auto;
            overflow: visible;
            transition: opacity 0.5s ease, height 0.5s ease;
        }
        .section-hidden {
            display: none;
        }
        .form-loading {
            position: relative;
            pointer-events: none;
        }
        .form-loading::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
        }
        .discount-badge {
            background-color: #ff8c00;
            color: black;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        .disney-promo {
            background: linear-gradient(135deg, #8b0000 0%, #ff4500 100%);
            border-left: 4px solid #ff8c00;
        }
        .promo-tag {
            background-color: #ff8c00;
            color: #111827;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        /* Colores degradados espec√≠ficos para cada plan con tem√°tica Halloween */
        .plan-100 {
            background: linear-gradient(135deg, #8b4513, #daa520);
            color: #fff;
        }
        
        .plan-200 {
            background: linear-gradient(135deg, #228b22, #32cd32);
            color: #000;
        }
        
        .plan-300 {
            background: linear-gradient(135deg, #4b0082, #8a2be2);
            color: #fff;
        }
        
        .plan-500 {
            background: linear-gradient(135deg, #ff4500, #ff8c00);
            color: #000;
        }
        
        .plan-1200 {
            background: linear-gradient(135deg, #8b0000, #dc143c);
            color: #fff;
        }
        
        .plan-5000 {
            background: linear-gradient(135deg, #00008b, #4169e1);
            color: #fff;
        }
        
        .plan-10000 {
            background: linear-gradient(135deg, #4b0082, #9400d3);
            color: #fff;
        }
        
        .btn-me-interesa {
            background: linear-gradient(135deg, #ff8c00, #ff4500);
            color: white;
            font-weight: 700;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-me-interesa:hover {
            background: linear-gradient(135deg, #ff4500, #8b0000);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 69, 0, 0.4);
        }
        
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background-color: #1a0b0b;
            border: 1px solid #ff8c00;
        }
        
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(255, 140, 0, 0.3);
        }
        
        .benefit-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            color: #e5e5e5;
        }
        
        .benefit-item:before {
            content: "üï∑Ô∏è";
            margin-right: 8px;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .recommended-badge {
            position: absolute;
            top: -10px;
            right: 20px;
            background: linear-gradient(135deg, #ff8c00, #ff4500);
            color: #000000;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 900;
            z-index: 10;
            box-shadow: 0 0 10px #ff8c00, 0 0 20px #ff8c00, 0 0 30px #ff8c00;
            animation: halloweenPulse 2s infinite alternate;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        @keyframes halloweenPulse {
            0% {
                box-shadow: 0 0 5px #ff8c00, 0 0 10px #ff8c00, 0 0 15px #ff8c00;
                transform: scale(1);
            }
            100% {
                box-shadow: 0 0 15px #ff8c00, 0 0 25px #ff8c00, 0 0 35px #ff8c00;
                transform: scale(1.05);
            }
        }
        
        input[type="checkbox"], input[type="radio"] {
            accent-color: #ff8c00;
        }
        
        .has-\[\:\checked\]\:bg-indigo-900\/50:has(:checked) {
            background-color: rgba(139, 0, 0, 0.5);
        }
        
        .has-\[\:\checked\]\:border-indigo-500:has(:checked) {
            border-color: #ff4500;
        }
        
        /* Animaciones para emojis flotantes */
        .floating-emoji {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            font-size: 1.5rem;
            animation: floatAround 20s infinite linear;
            opacity: 0.7;
        }
        
        @keyframes floatAround {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(100px, 100px) rotate(90deg);
            }
            50% {
                transform: translate(200px, 0) rotate(180deg);
            }
            75% {
                transform: translate(100px, -100px) rotate(270deg);
            }
            100% {
                transform: translate(0, 0) rotate(360deg);
            }
        }
        
        .ghost-float {
            animation: ghostFloat 3s ease-in-out infinite;
        }
        
        @keyframes ghostFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .bat-fly {
            animation: batFly 4s ease-in-out infinite;
        }
        
        @keyframes batFly {
            0%, 100% {
                transform: translateX(0) translateY(0) rotate(0deg);
            }
            25% {
                transform: translateX(20px) translateY(-15px) rotate(5deg);
            }
            50% {
                transform: translateX(0) translateY(-25px) rotate(0deg);
            }
            75% {
                transform: translateX(-20px) translateY(-15px) rotate(-5deg);
            }
        }
        
        .pumpkin-bounce {
            animation: pumpkinBounce 5s ease-in-out infinite;
        }
        
        @keyframes pumpkinBounce {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-15px) rotate(5deg);
            }
            50% {
                transform: translateY(0) rotate(0deg);
            }
            75% {
                transform: translateY(-10px) rotate(-5deg);
            }
        }
        
        .skeleton-dance {
            animation: skeletonDance 6s ease-in-out infinite;
        }
        
        @keyframes skeletonDance {
            0%, 100% {
                transform: translateX(0) rotate(0deg);
            }
            25% {
                transform: translateX(15px) rotate(10deg);
            }
            50% {
                transform: translateX(0) rotate(0deg);
            }
            75% {
                transform: translateX(-15px) rotate(-10deg);
            }
        }
        
        .spider-crawl {
            animation: spiderCrawl 8s linear infinite;
        }
        
        @keyframes spiderCrawl {
            0% {
                transform: translateX(-100px) translateY(0) rotate(0deg);
            }
            50% {
                transform: translateX(100px) translateY(50px) rotate(180deg);
            }
            100% {
                transform: translateX(-100px) translateY(0) rotate(360deg);
            }
        }
        
        .ghost-blink {
            animation: ghostBlink 2s infinite;
        }
        
        @keyframes ghostBlink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.3;
            }
        }
        
        .btn-ghost {
            position: relative;
        }
        
        .btn-ghost::before {
            content: "üëª";
            position: absolute;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            animation: ghostBlink 2s infinite;
        }
    </style>
</head>
<body class="bg-black text-white">

    <!-- Emojis flotantes -->
    <div id="floating-emojis"></div>

    <!-- Header -->
    <header class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-50 shadow-lg border-b border-orange-600">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-xl md:text-2xl font-bold text-white">
                <span class="halloween-text">Asesor Autorizado</span> Totalplay¬Æ
            </div>
            <div class="text-right">
                <p class="font-semibold">Juan Mel√©ndez</p>
                <p class="text-sm text-orange-400">Tu experto en conectividad</p>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <main class="container mx-auto px-6">
        <section id="inicio" class="min-h-[80vh] flex items-center halloween-gradient rounded-3xl mt-8 p-8 md:p-16 relative">
            <div class="max-w-3xl relative z-10">
                <h1 class="text-4xl md:text-6xl font-extrabold text-white leading-tight">
                    <span class="halloween-text">¬°El LAG tiene MIEDO de estos MEGAS!</span>
                </h1>
                <p class="mt-6 text-lg text-orange-200">
                    üéÉ Instalaci√≥n EXPRESS sin costo - Precio FIJO por 12 meses - Descuentos ESPELUZNANTES üéÉ
                </p>
                <div id="promo-banner" class="mt-8 bg-orange-900/30 p-4 rounded-xl border border-orange-600">
                    <p class="text-center font-bold text-yellow-300 text-lg">
                        üëª ¬°OFERTAS DE TERROR por tiempo limitado! V√°lido hasta <span id="current-day"></span>.
                    </p>
                </div>
                <a href="#planes" id="ver-planes-btn" class="mt-10 inline-block bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-bold text-lg py-4 px-10 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-300">
                    üëª Ver Planes ATERRADORES
                </a>
            </div>
        </section>

        <!-- Plans Section -->
        <section id="planes" class="py-20">
            <div class="text-center">
                <div class="promo-gradient p-8 rounded-2xl mb-12 shadow-2xl border border-orange-600">
                    <h2 class="text-4xl font-extrabold text-white">Elige el plan que har√° TEMBLAR al LAG</h2>
                    <p class="text-orange-200 mt-2 text-lg">Velocidades tan r√°pidas que asustan üëª</p>
                </div>

                <div id="plan-type-buttons" class="flex justify-center gap-4 mb-10 bg-gray-900 p-2 rounded-full max-w-md mx-auto border border-orange-600">
                    <button id="btn-internet" class="plan-type-btn flex-1 bg-orange-600 text-white font-bold py-3 px-8 rounded-full transition-colors duration-300">Solo Internet</button>
                    <button id="btn-combo" class="plan-type-btn flex-1 bg-transparent hover:bg-orange-900 text-white font-bold py-3 px-8 rounded-full transition-colors duration-300">Internet + TV</button>
                </div>

                <div id="plan-cards-container" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
                    <!-- Las tarjetas de planes se insertar√°n aqu√≠ con JS -->
                </div>
            </div>
        </section>

        <!-- Benefits Section -->
        <section id="beneficios" class="py-20">
            <h2 class="text-3xl font-bold text-center mb-12 halloween-text">Beneficios que dan MIEDO de buenos</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="bg-gray-900 p-8 rounded-2xl border border-orange-600 transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-orange-400 mb-3">üëª Velocidad de ESPANTO</h3>
                    <p class="text-gray-400">Disfruta la misma velocidad para subir y descargar archivos. Tan r√°pido que da miedo.</p>
                </div>
                <div class="bg-gray-900 p-8 rounded-2xl border border-orange-600 transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-orange-400 mb-3">üéÉ Precio Fijo EMBRUJADO</h3>
                    <p class="text-gray-400">Te mantenemos el mismo precio durante 12 meses. Sin fantasmas en tu factura.</p>
                </div>
                <div class="bg-gray-900 p-8 rounded-2xl border border-orange-600 transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-orange-400 mb-3">ü¶á Soporte T√©cnico NOCTURNO</h3>
                    <p class="text-gray-400">Accede a nuestra l√≠nea de atenci√≥n t√©cnica 24/7 con asesores que no duermen.</p>
                </div>
                <div class="bg-gray-900 p-8 rounded-2xl border border-orange-600 transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-orange-400 mb-3">üíÄ Instalaci√≥n SIN COSTO</h3>
                    <p class="text-gray-400">Instalaci√≥n profesional incluida con valor de $350 MXN. Paga hoy $0 por la instalaci√≥n.</p>
                </div>
            </div>
        </section>

        <!-- Add-ons Section -->
        <section id="addons-section" class="hidden py-12">
             <div id="addons-intro" class="max-w-3xl mx-auto text-center bg-gray-900 rounded-3xl p-8 md:p-12 border border-orange-600">
                <h2 class="text-3xl font-bold mb-4 halloween-text">¬°Personaliza tu paquete de TERROR!</h2>
                <p class="text-orange-300 mb-8">¬øDeseas agregar servicios de streaming, apps o dispositivos a tu plan?</p>
                 <div class="flex justify-center gap-4">
                    <button id="btn-addons-yes" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-10 rounded-full transition-colors duration-300">¬°S√≠, agregar!</button>
                    <button id="btn-addons-no" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-10 rounded-full transition-colors duration-300">No, gracias</button>
                </div>
            </div>
            
            <div id="addons-options" class="hidden max-w-4xl mx-auto mt-12 space-y-10">
                <!-- Las opciones de adicionales se insertar√°n aqu√≠ -->
            </div>
        </section>

        <!-- Contact Form & Summary Section -->
        <section id="contact-section" class="hidden py-20">
            <div class="max-w-4xl mx-auto bg-gray-900 p-8 md:p-12 rounded-3xl border border-orange-800 grid md:grid-cols-2 gap-12">
                <div>
                    <h2 class="text-3xl font-bold mb-2 halloween-text">¬°Casi listo para el TERROR!</h2>
                    <p class="text-orange-300 mb-6">Completa tus datos para finalizar tu solicitud. Me pondr√© en contacto contigo a la brevedad para coordinar la instalaci√≥n.</p>
                    <form id="contact-form">
                        <div class="mb-4">
                            <label for="nombre" class="block mb-2 text-sm font-medium text-orange-300">Nombre Completo</label>
                            <input type="text" id="nombre" name="nombre" class="bg-gray-800 border border-orange-700 text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block w-full p-2.5" placeholder="Tu nombre" required>
                        </div>
                        <div class="mb-4">
                            <label for="correo" class="block mb-2 text-sm font-medium text-orange-300">Correo Electr√≥nico</label>
                            <input type="email" id="correo" name="correo" class="bg-gray-800 border border-orange-700 text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block w-full p-2.5" placeholder="tu@correo.com" required>
                        </div>
                        <div class="mb-6">
                            <label for="telefono" class="block mb-2 text-sm font-medium text-orange-300">Tel√©fono (WhatsApp)</label>
                            <input type="tel" id="telefono" name="telefono" class="bg-gray-800 border border-orange-700 text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block w-full p-2.5" placeholder="10 d√≠gitos" required pattern="\d{10}">
                        </div>
                        <div class="mb-6">
                            <label class="flex items-center">
                                <input type="checkbox" id="portabilidad" name="portabilidad" class="custom-checkbox rounded">
                                <span class="ml-2 text-orange-300">¬øDeseas portar tu n√∫mero? (Obt√©n descuento en tu segunda mensualidad)</span>
                            </label>
                        </div>
                    </form>
                </div>
                <div class="bg-black p-6 rounded-2xl flex flex-col border border-orange-700">
                    <h3 class="text-xl font-bold mb-4 halloween-text">Resumen de tu pedido de TERROR</h3>
                    <div id="summary-content" class="space-y-3 text-orange-300 flex-grow">
                        <!-- El resumen se insertar√° aqu√≠ con JS -->
                    </div>
                     <div class="border-t border-orange-800 mt-4 pt-4">
                        <div class="flex justify-between items-center text-xl font-bold">
                            <span class="text-orange-300">Total Mensual por 5 meses:</span>
                            <span id="summary-total" class="halloween-text">$0 por 5 meses</span>
                        </div>
                        <div class="flex justify-between items-center text-lg text-green-400 mt-2">
                            <span>Costo de Instalaci√≥n Extra:</span>
                            <span id="summary-install" class="text-green-400">$0 (Valor $350)</span>
                        </div>
                        <div class="flex justify-between items-center text-xl font-bold mt-2 pt-2 border-t border-orange-800">
                            <span class="text-orange-300">Pago Inicial:</span>
                            <span id="summary-install-price" class="halloween-text">$0</span>
                        </div>
                    </div>
                    <button id="btn-continue" type="button" class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full transition-colors duration-300 disabled:bg-gray-700 disabled:cursor-not-allowed flex items-center justify-center gap-2 btn-ghost" disabled>
                        <span id="continue-text">Enviar solicitud por WhatsApp</span>
                        <div id="continue-loader" class="hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </button>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section id="testimonios" class="py-20">
            <h2 class="text-3xl font-bold text-center mb-12 halloween-text">Lo que dicen nuestros clientes ASUSTADOS</h2>
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="bg-gray-900 p-8 rounded-2xl border border-orange-600">
                    <p class="text-gray-400 mb-6">"La atenci√≥n de Juan fue excelente. Me explic√≥ todo con claridad y la instalaci√≥n fue s√∫per r√°pida. Internet vuela, 100% recomendado!"</p>
                    <div class="font-bold text-right text-orange-400">- Sof√≠a G.</div>
                </div>
                <div class="bg-gray-900 p-8 rounded-2xl border border-orange-600">
                    <p class="text-gray-400 mb-6">"Ten√≠a muchas dudas sobre qu√© plan me conven√≠a para mis clases en l√≠nea y para jugar. El asesor me ayud√≥ a elegir el paquete perfecto y ahora todo funciona de maravilla."</p>
                    <div class="font-bold text-right text-orange-400">- Carlos M.</div>
                </div>
                <div class="bg-gray-900 p-8 rounded-2xl border border-orange-600">
                    <p class="text-gray-400 mb-6">"Contratar fue muy sencillo y sin tanto rollo. Me gustaron las promociones que me ofreci√≥ y el servicio ha sido muy estable desde el primer d√≠a."</p>
                    <div class="font-bold text-right text-orange-400">- Laura V.</div>
                </div>
            </div>
        </section>
        
        <!-- Support Section -->
        <section id="soporte" class="py-20 text-center">
            <div class="bg-gray-900 max-w-2xl mx-auto p-8 rounded-2xl border border-orange-600">
                <h2 class="text-2xl font-bold mb-4 halloween-text">¬øNecesitas Soporte T√©cnico?</h2>
                <p class="text-orange-300 mb-4">Si ya eres cliente y presentas una falla, comun√≠cate directamente a la l√≠nea de soporte t√©cnico para una atenci√≥n inmediata.</p>
                <p class="text-3xl font-bold halloween-text tracking-widest">800 510 0510</p>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 mt-20 border-t border-orange-600">
        <div class="container mx-auto px-6 py-8 text-center text-orange-400">
            <p>&copy; <span id="current-year"></span> Juan Mel√©ndez - Asesor Autorizado Totalplay. Todos los derechos reservados.</p>
            <p class="text-sm mt-2">Este sitio es gestionado por un asesor de ventas autorizado. Totalplay¬Æ es una marca registrada.</p>
             <p class="text-xs mt-4">P√°gina creada por Juan Mel√©ndez</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- CONFIGURATION ---
            const WHATSAPP_NUMBER = '5218131191393';
            const MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/jigm042t5atf3tci3j82n3cxysiva3f0';
            
            // Verificar si estamos en periodo promocional (hasta el 31 de octubre de 2025)
            function isPromoPeriod() {
                const today = new Date();
                const promoEnd = new Date('2025-10-31');
                return today <= promoEnd;
            }
            
            // Datos de portabilidad (solo disponible durante promoci√≥n)
            const portabilityDiscount = isPromoPeriod() ? {
                'internet': 100,
                'combo': 200
            } : {
                'internet': 0,
                'combo': 0
            };
            
            // --- ANIMACIONES DE EMOJIS ---
            function createFloatingEmojis() {
                const emojis = ['üëª', 'üéÉ', 'ü¶á', 'üíÄ', 'üï∑Ô∏è', 'üï∏Ô∏è', 'üßõ', 'üßü', '‚ò†Ô∏è'];
                const container = document.getElementById('floating-emojis');
                const numEmojis = 15;
                
                for (let i = 0; i < numEmojis; i++) {
                    const emoji = document.createElement('div');
                    emoji.className = 'floating-emoji';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    
                    // Posici√≥n aleatoria
                    const left = Math.random() * 100;
                    const top = Math.random() * 100;
                    const delay = Math.random() * 20;
                    const duration = 15 + Math.random() * 15;
                    
                    // Aplicar diferentes animaciones seg√∫n el emoji
                    if (emoji.textContent === 'üëª') {
                        emoji.style.animation = `ghostFloat 3s ease-in-out infinite, floatAround ${duration}s infinite linear ${delay}s`;
                    } else if (emoji.textContent === 'ü¶á') {
                        emoji.style.animation = `batFly 4s ease-in-out infinite, floatAround ${duration}s infinite linear ${delay}s`;
                    } else if (emoji.textContent === 'üéÉ') {
                        emoji.style.animation = `pumpkinBounce 5s ease-in-out infinite, floatAround ${duration}s infinite linear ${delay}s`;
                    } else if (emoji.textContent === 'üíÄ' || emoji.textContent === 'üßü') {
                        emoji.style.animation = `skeletonDance 6s ease-in-out infinite, floatAround ${duration}s infinite linear ${delay}s`;
                    } else if (emoji.textContent === 'üï∑Ô∏è') {
                        emoji.style.animation = `spiderCrawl 8s linear infinite, floatAround ${duration}s infinite linear ${delay}s`;
                    } else {
                        emoji.style.animation = `floatAround ${duration}s infinite linear ${delay}s`;
                    }
                    
                    emoji.style.left = `${left}%`;
                    emoji.style.top = `${top}%`;
                    emoji.style.fontSize = `${1 + Math.random() * 1.5}rem`;
                    emoji.style.opacity = `${0.3 + Math.random() * 0.5}`;
                    
                    container.appendChild(emoji);
                }
            }
            
            // Eventos personalizados para Facebook Pixel
            function trackFacebookEvent(eventName, parameters) {
                if (typeof fbq !== 'undefined') {
                    fbq('track', eventName, parameters);
                }
            }
            
            // Track time on page events
            setTimeout(() => {
                trackFacebookEvent('TimeOnPage30', {
                    content_name: document.title,
                    content_category: 'Page Engagement'
                });
            }, 30000);

            setTimeout(() => {
                trackFacebookEvent('TimeOnPage60', {
                    content_name: document.title,
                    content_category: 'Page Engagement'
                });
            }, 60000);

            setTimeout(() => {
                trackFacebookEvent('TimeOnPage120', {
                    content_name: document.title,
                    content_category: 'Page Engagement'
                });
            }, 120000);
            
            // --- PLANS AND ADD-ONS DATA ---
            const plansData = {
                internet: [
                    { 
                        megas: 100, 
                        promoMegas: 200,
                        regularPrice: 510,
                        promoPrice: 460, // Precio promoci√≥n al pagar puntual
                        finalPrice: 400, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["Fibra √≥ptica", "Club WiFi Totalplay"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 20 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: true
                    },
                    { 
                        megas: 200, 
                        promoMegas: 300,
                        regularPrice: 620,
                        promoPrice: 570, // Precio promoci√≥n al pagar puntual
                        finalPrice: 510, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["Fibra √≥ptica", "Club WiFi", "Apple TV+ 1 a√±o"],
                        recommended: true,
                        lifetimeDiscount: isPromoPeriod() ? 20 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: true
                    },
                    { 
                        megas: 300, 
                        promoMegas: 500,
                        regularPrice: 730,
                        promoPrice: 680, // Precio promoci√≥n al pagar puntual
                        finalPrice: 620, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["Fibra √≥ptica", "Club WiFi", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 30 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: true
                    },
                    { 
                        megas: 500, 
                        promoMegas: 1200,
                        regularPrice: 880,
                        promoPrice: 830, // Precio promoci√≥n al pagar puntual
                        finalPrice: 770, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["Fibra √≥ptica", "WiFi 6", "Club WiFi", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 60 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: true
                    },
                    { 
                        megas: 1200, 
                        promoMegas: 1200,
                        regularPrice: 1550,
                        promoPrice: 1470, // Precio promoci√≥n al pagar puntual
                        finalPrice: 1410, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["Fibra √≥ptica", "WiFi 6", "Club WiFi", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 80 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: false // NO mostrar "Megas extra" para 1200
                    },
                    { 
                        megas: 5000, 
                        promoMegas: 5000,
                        regularPrice: 2380,
                        promoPrice: 1999, // Precio promocional por lanzamiento
                        finalPrice: 1939, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["Fibra √≥ptica", "WiFi 7", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 80 : 0,
                        discountFromMonth: 6, // A partir del 6to mes
                        showExtraMegas: false
                    },
                    { 
                        megas: 10000, 
                        promoMegas: 10000,
                        regularPrice: 3080,
                        promoPrice: 2499, // Precio promocional por lanzamiento
                        finalPrice: 2439, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["Fibra √≥ptica", "WiFi 7", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 80 : 0,
                        discountFromMonth: 6, // A partir del 6to mes
                        showExtraMegas: false
                    }
                ],
                combo: [
                    { 
                        megas: 100, 
                        promoMegas: 200,
                        regularPrice: 650,
                        promoPrice: 600, // Precio promoci√≥n al pagar puntual
                        finalPrice: 540, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["185 canales", "Convertidor Smart TV"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 30 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: true
                    },
                    { 
                        megas: 200, 
                        promoMegas: 300,
                        regularPrice: 760,
                        promoPrice: 710, // Precio promoci√≥n al pagar puntual
                        finalPrice: 650, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["185 canales", "Convertidor Smart TV", "Alexa", "Apple TV+ 1 a√±o"],
                        recommended: true,
                        lifetimeDiscount: isPromoPeriod() ? 30 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: true
                    },
                    { 
                        megas: 300, 
                        promoMegas: 500,
                        regularPrice: 870,
                        promoPrice: 820, // Precio promoci√≥n al pagar puntual
                        finalPrice: 760, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["185 canales", "Convertidor Smart TV", "Alexa", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 40 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: true
                    },
                    { 
                        megas: 500, 
                        promoMegas: 1200,
                        regularPrice: 1050,
                        promoPrice: 1000, // Precio promoci√≥n al pagar puntual
                        finalPrice: 940, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["185 canales", "Convertidor Smart TV", "Alexa", "Bocinas B&O", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 50 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: true
                    },
                    { 
                        megas: 1200, 
                        promoMegas: 1200,
                        regularPrice: 1720,
                        promoPrice: 1640, // Precio promoci√≥n al pagar puntual
                        finalPrice: 1580, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["185 canales", "Convertidor Smart TV", "Alexa", "Bocinas B&O", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 100 : 0,
                        discountFromMonth: 6, // Cambiado de 3er mes a 6to mes
                        showExtraMegas: false // NO mostrar "Megas extra" para 1200
                    },
                    { 
                        megas: 5000, 
                        promoMegas: 5000,
                        regularPrice: 2880,
                        promoPrice: 2499, // Precio promocional por lanzamiento
                        finalPrice: 2439, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["185 canales", "WiFi 7", "Servicio para 1 TV con Alexa y Totalplay Surround", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 100 : 0,
                        discountFromMonth: 6, // A partir del 6to mes
                        showExtraMegas: false
                    },
                    { 
                        megas: 10000, 
                        promoMegas: 10000,
                        regularPrice: 3580,
                        promoPrice: 2999, // Precio promocional por lanzamiento
                        finalPrice: 2939, // Precio con descuento de $60 por 5 meses
                        formattedDesc: ["185 canales", "WiFi 7", "Servicio para 1 TV con Alexa y Totalplay Surround", "Apple TV+ 1 a√±o"],
                        recommended: false,
                        lifetimeDiscount: isPromoPeriod() ? 100 : 0,
                        discountFromMonth: 6, // A partir del 6to mes
                        showExtraMegas: false
                    }
                ]
            };

            const addonsData = {
                streaming: {
                    prime: { id: 'prime', name: 'Amazon Prime', price: 90 },
                    netflix: {
                        id: 'netflix', name: 'Netflix', tiers: [
                            { id: 'netflix-anuncios', name: 'Netflix con Anuncios', price: 110 },
                            { id: 'netflix-estandar', name: 'Netflix Est√°ndar (2 pantallas)', price: 229 },
                            { id: 'netflix-premium', name: 'Netflix Premium (4 pantallas)', price: 299 },
                        ]
                    }
                },
                disney: {
                    id: 'disney', 
                    name: 'Disney+', 
                    tiers: [
                        { 
                            id: 'disney-estandar', 
                            name: 'Disney+ Est√°ndar', 
                            price: 89, 
                            promo: '4 meses', 
                            regularPrice: 249, 
                            description: 'Para 2 dispositivos a la vez sin publicidad' 
                        },
                        { 
                            id: 'disney-premium', 
                            name: 'Disney+ Premium', 
                            price: 95, 
                            promo: '4 meses', 
                            regularPrice: 319, 
                            description: 'Para 4 dispositivos a la vez sin publicidad' 
                        }
                    ]
                },
                app_packages: [
                    { id: 'paq-basico', name: 'Paquete 2 Apps B√°sicas', price: 199, limit: 2, apps: [ 'Amazon Prime', 'HBO con Anuncios', 'Paramount+' ] },
                    { id: 'paq-estandar-2', name: 'Paquete 2 Apps Est√°ndar', price: 399, limit: 2, apps: [ 'Fox Sports Premium', 'NBA League Pass', 'HBO MAX', 'Disney+ Est√°ndar' ] },
                    { id: 'paq-estandar-3', name: 'Paquete 3 Apps Est√°ndar', price: 599, limit: 3, apps: [ 'Fox Sports Premium', 'NBA League Pass', 'HBO MAX', 'Disney+ Est√°ndar' ] },
                ],
                devices: {
                    wifiPro: { id: 'wifi-pro', name: 'WifiPro', price: 69, tvOnly: false },
                    tvAdicional: { id: 'tv-adicional', name: 'TV Adicional', price: 129, tvOnly: true },
                    tvAdicionalAlexa: { id: 'tv-adicional-alexa', name: 'TV Adicional con Alexa', price: 280, tvOnly: true },
                    sonidoSurround: { id: 'sonido-surround', name: 'Sonido Surround', price: 199, tvOnly: true }
                }
            };
            
            // --- APPLICATION STATE ---
            let selection = {
                plan: null, 
                planType: 'internet',
                streaming: { service: null, tier: null, price: 0 },
                disney: { service: null, tier: null, price: 0 },
                appPackage: { data: null, selectedApps: [], price: 0 },
                devices: [], 
                total: 0,
                portability: false,
                installPrice: 350,
                portabilityDiscount: 0
            };

            // --- DOM ELEMENTS ---
            const dom = {
                planCardsContainer: document.getElementById('plan-cards-container'),
                addonsSection: document.getElementById('addons-section'),
                addonsIntro: document.getElementById('addons-intro'),
                addonsOptionsContainer: document.getElementById('addons-options'),
                contactSection: document.getElementById('contact-section'),
                contactForm: document.getElementById('contact-form'),
                btnContinue: document.getElementById('btn-continue'),
                formInputs: document.querySelectorAll('#contact-form input'),
                summaryContent: document.getElementById('summary-content'),
                summaryTotal: document.getElementById('summary-total'),
                summaryInstall: document.getElementById('summary-install'),
                summaryInstallPrice: document.getElementById('summary-install-price'),
                continueText: document.getElementById('continue-text'),
                continueLoader: document.getElementById('continue-loader'),
                planTypeButtons: document.querySelectorAll('.plan-type-btn'),
                beneficiosSection: document.getElementById('beneficios'),
                testimoniosSection: document.getElementById('testimonios'),
                soporteSection: document.getElementById('soporte'),
                inicioSection: document.getElementById('inicio'),
                verPlanesBtn: document.getElementById('ver-planes-btn'),
                portabilityCheckbox: document.getElementById('portabilidad')
            };

            // --- FUNCTIONS ---

            function setPromoDate() {
                const dayElement = document.getElementById('current-day');
                const today = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                dayElement.textContent = today.toLocaleDateString('es-ES', options);
                document.getElementById('current-year').textContent = today.getFullYear();
                
                // Actualizar banner de promoci√≥n seg√∫n periodo
                const promoBanner = document.getElementById('promo-banner');
                if (isPromoPeriod()) {
                    promoBanner.innerHTML = '<p class="text-center font-bold text-yellow-300 text-lg">üëª ¬°OFERTAS DE TERROR hasta el 31 de Octubre 2025! Descuento de $60 por 5 meses + Descuento desde 6to mes</p>';
                }
            }

            function hideNonPlanSections() {
                // Ocultar secciones que no son relevantes para el proceso de contrataci√≥n
                dom.beneficiosSection.classList.add('section-hidden');
                dom.testimoniosSection.classList.add('section-hidden');
                dom.soporteSection.classList.add('section-hidden');
                dom.inicioSection.classList.add('fade-out');
                
                // Asegurarse de que las secciones de planes sean visibles
                document.getElementById('planes').classList.remove('section-hidden');
                document.getElementById('planes').scrollIntoView({ behavior: 'smooth' });
                
                // Track event for Facebook Pixel
                trackFacebookEvent('ViewContent', {
                    content_name: 'Planes de Internet',
                    content_category: 'Internet Plans'
                });
            }

            // Funci√≥n para determinar la clase de color seg√∫n los megas
            function getColorClass(megas) {
                switch(megas) {
                    case 100: return "plan-100";
                    case 200: return "plan-200";
                    case 300: return "plan-300";
                    case 500: return "plan-500";
                    case 1200: return "plan-1200";
                    case 5000: return "plan-5000";
                    case 10000: return "plan-10000";
                    default: return "plan-100";
                }
            }

            function renderPlanCards(type) {
                selection.planType = type;
                dom.planCardsContainer.innerHTML = '';
                const isPromoActive = isPromoPeriod();
                
                plansData[type].forEach(plan => {
                    const currentMegas = isPromoActive ? plan.promoMegas : plan.megas;
                    const currentPrice = isPromoActive ? plan.finalPrice : plan.regularPrice;
                    const colorClass = getColorClass(plan.megas);
                    
                    // Generar los beneficios formateados
                    const benefitsHTML = plan.formattedDesc.map(benefit => 
                        `<div class="benefit-item">${benefit}</div>`
                    ).join('');
                    
                    const card = `
                        <div class="card-hover p-6 rounded-2xl text-center flex flex-col relative h-full">
                            ${plan.recommended ? '<div class="recommended-badge">Recomendado</div>' : ''}
                            
                            ${isPromoActive && plan.showExtraMegas ? `
                                <!-- Encabezado de promoci√≥n - SOLO para planes que no son 1200, 5000 o 10000 megas -->
                                <div class="bg-orange-500 text-white text-center py-2 rounded-t-lg -mx-6 -mt-6 mb-4 font-bold">
                                    + Megas por 4 meses
                                </div>
                            ` : ''}
                            
                            ${isPromoActive && plan.megas >= 5000 ? `
                                <!-- Encabezado especial para nuevos planes -->
                                <div class="bg-purple-600 text-white text-center py-2 rounded-t-lg -mx-6 -mt-6 mb-4 font-bold">
                                    ¬°NUEVO PLAN!
                                </div>
                            ` : ''}
                            
                            <!-- T√≠tulo del plan con color degradado -->
                            <div class="${colorClass} p-4 rounded-xl text-center mb-4">
                                <h3 class="text-2xl font-bold">${currentMegas} Megas ${isPromoActive && currentMegas > plan.megas && plan.showExtraMegas ? 'x 4 meses' : ''}</h3>
                                <p class="font-semibold">${type === 'combo' ? 'Internet + TV' : 'Internet Sim√©trico*'}</p>
                                ${isPromoActive && currentMegas > plan.megas && plan.showExtraMegas ? 
                                    `<p class="text-sm mt-1">Despu√©s: ${plan.megas} Megas</p>` : 
                                    `<p class="text-sm mt-1">Velocidad Sim√©trica</p>`
                                }
                            </div>
                            
                            <!-- Descripci√≥n del plan formateada -->
                            <div class="text-left mb-4 flex-grow">
                                ${benefitsHTML}
                            </div>
                            
                            <!-- Detalles de descuentos -->
                            ${plan.lifetimeDiscount > 0 ? `
                                <div class="text-xs text-gray-400 mb-4">
                                    <div class="flex items-center justify-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                        <span>Descuento de por vida: $${plan.lifetimeDiscount} a partir del ${plan.discountFromMonth}${plan.discountFromMonth === 6 ? 'to' : 'er'} mes</span>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Precio - MOSTRAR PRECIO POR 5 MESES CLARAMENTE -->
                            <div class="my-6">
                                ${isPromoActive ? `
                                    <div class="space-y-2">
                                        <div class="text-center">
                                            <span class="text-4xl font-extrabold text-white">$${plan.finalPrice}</span>
                                            <span class="text-gray-400">/mes por 5 meses</span>
                                        </div>
                                        <div class="flex flex-col items-center justify-center space-y-1 text-sm">
                                            <div class="flex items-center">
                                                <span class="text-gray-500 line-through mr-2">$${plan.regularPrice}</span>
                                                <span class="text-green-400">Precio de lista</span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-gray-500">$${plan.promoPrice} a partir del 6to mes</span>
                                                <span class="text-green-400 ml-2">Precio promoci√≥n</span>
                                            </div>
                                        </div>
                                    </div>
                                ` : `
                                    <span class="text-4xl font-extrabold text-white">$${plan.regularPrice}</span>
                                    <span class="text-gray-400">/mes</span>
                                `}
                            </div>
                            
                            <button class="select-plan-btn mt-auto btn-me-interesa py-3 px-6 rounded-full w-full btn-ghost"
                                data-megas="${plan.megas}" data-promo-megas="${currentMegas}" data-price="${currentPrice}" data-regular-price="${plan.regularPrice}" data-promo-price="${plan.promoPrice}" data-lifetime-discount="${plan.lifetimeDiscount}">
                                Me interesa
                            </button>
                        </div>
                    `;
                    dom.planCardsContainer.innerHTML += card;
                });
            }

            function renderAddonsOptions() {
                const { streaming, disney, app_packages, devices } = addonsData;
                const isTvPlan = selection.planType === 'combo';
                
                let streamingOptions = `
                    <label class="flex items-center p-3 bg-gray-800 rounded-lg has-[:checked]:bg-orange-900/50 border-2 border-transparent has-[:checked]:border-orange-500">
                        <input type="radio" name="streaming" value="none" class="custom-radio" checked> 
                        <span class="ml-3">Ninguno</span>
                    </label>
                    <label class="flex items-center p-3 bg-gray-800 rounded-lg has-[:checked]:bg-orange-900/50 border-2 border-transparent has-[:checked]:border-orange-500">
                        <input type="radio" name="streaming" value="prime" class="custom-radio"> 
                        <span class="ml-3">${streaming.prime.name} (+$${streaming.prime.price})</span>
                    </label>
                    <label class="flex items-center p-3 bg-gray-800 rounded-lg has-[:checked]:bg-orange-900/50 border-2 border-transparent has-[:checked]:border-orange-500">
                        <input type="radio" name="streaming" value="netflix" class="custom-radio"> 
                        <span class="ml-3">${streaming.netflix.name}</span>
                    </label>`;
                
                let netflixTiers = '';
                streaming.netflix.tiers.forEach(tier => {
                    netflixTiers += `
                        <label class="flex items-center p-3 bg-gray-800 rounded-lg has-[:checked]:bg-orange-900/50 border-2 border-transparent has-[:checked]:border-orange-500">
                            <input type="radio" name="netflix-tier" value="${tier.id}" class="custom-radio"> 
                            <span class="ml-3">${tier.name} (+$${tier.price})</span>
                        </label>`;
                });
                
                let disneyOptions = `
                    <label class="flex items-center p-3 bg-gray-800 rounded-lg has-[:checked]:bg-orange-900/50 border-2 border-transparent has-[:checked]:border-orange-500">
                        <input type="radio" name="disney" value="none" class="custom-radio" checked> 
                        <span class="ml-3">Ninguno</span>
                    </label>`;
                
                disney.tiers.forEach(tier => {
                    disneyOptions += `
                        <label class="flex items-center p-3 bg-gray-800 rounded-lg has-[:checked]:bg-orange-900/50 border-2 border-transparent has-[:checked]:border-orange-500">
                            <input type="radio" name="disney" value="${tier.id}" class="custom-radio"> 
                            <span class="ml-3">${tier.name} (+$${tier.price} por ${tier.promo})</span>
                        </label>
                        <div class="disney-promo p-3 rounded-lg mb-3 ml-6">
                            <p class="text-sm text-white">${tier.description}. A partir del 5to mes: $${tier.regularPrice}</p>
                        </div>`;
                });
                
                let appPackageOptions = '';
                app_packages.forEach(pkg => {
                    appPackageOptions += `
                        <label class="flex items-center p-3 bg-gray-800 rounded-lg has-[:checked]:bg-orange-900/50 border-2 border-transparent has-[:checked]:border-orange-500">
                            <input type="radio" name="app-package" value="${pkg.id}" class="custom-radio">
                            <span class="ml-3">${pkg.name} (+$${pkg.price})</span>
                        </label>`;
                });
                
                let deviceOptions = '';
                Object.values(devices).forEach(device => {
                    if (!device.tvOnly || isTvPlan) {
                        deviceOptions += `
                            <label class="flex items-center p-3 bg-gray-800 rounded-lg has-[:checked]:bg-orange-900/50 border-2 border-transparent has-[:checked]:border-orange-500">
                                <input type="checkbox" name="device" value="${device.id}" class="custom-checkbox"> 
                                <span class="ml-3">${device.name} (+$${device.price})</span>
                            </label>`;
                    }
                });
                
                dom.addonsOptionsContainer.innerHTML = `
                    <div class="bg-gray-900 p-6 rounded-2xl border border-orange-600">
                        <h3 class="text-xl font-bold mb-4 halloween-text">1. Elige una plataforma de Streaming (opcional)</h3>
                        <div class="space-y-3" id="streaming-choice">
                            ${streamingOptions}
                        </div>
                        <div id="netflix-tiers" class="hidden mt-4 ml-6 space-y-3 border-l-2 border-orange-700 pl-6">
                            ${netflixTiers}
                        </div>
                    </div>
                    <div class="bg-gray-900 p-6 rounded-2xl border border-orange-600">
                        <h3 class="text-xl font-bold mb-4 halloween-text">2. Elige Disney+ (opcional)</h3>
                        <div class="space-y-3" id="disney-choice">
                            ${disneyOptions}
                        </div>
                    </div>
                    <div class="bg-gray-900 p-6 rounded-2xl border border-orange-600">
                        <h3 class="text-xl font-bold mb-4 halloween-text">3. Elige un paquete de Apps (opcional)</h3>
                        <div class="space-y-3" id="package-choice">
                            <label class="flex items-center p-3 bg-gray-800 rounded-lg has-[:checked]:bg-orange-900/50 border-2 border-transparent has-[:checked]:border-orange-500">
                                <input type="radio" name="app-package" value="none" class="custom-radio" checked> 
                                <span class="ml-3">Ninguno</span>
                            </label>
                            ${appPackageOptions}
                        </div>
                        <div id="package-apps-container" class="mt-4"></div>
                    </div>
                    <div class="bg-gray-900 p-6 rounded-2xl border border-orange-600">
                        <h3 class="text-xl font-bold mb-4 halloween-text">4. Agrega Dispositivos (opcional)</h3>
                        <div class="space-y-3" id="device-choice">
                            ${deviceOptions}
                        </div>
                    </div>`;
                
                dom.addonsOptionsContainer.classList.remove('hidden');
                
                // Ocultar opci√≥n de portabilidad si no est√° en periodo promocional
                if (!isPromoPeriod()) {
                    const portabilityLabel = document.querySelector('label[for="portabilidad"]');
                    if (portabilityLabel) {
                        portabilityLabel.style.display = 'none';
                    }
                    const portabilityCheckbox = document.getElementById('portabilidad');
                    if (portabilityCheckbox) {
                        portabilityCheckbox.style.display = 'none';
                    }
                }
            }

            function renderPackageApps(packageId) {
                const container = document.getElementById('package-apps-container');
                const pkg = addonsData.app_packages.find(p => p.id === packageId);
                if (!pkg) { 
                    container.innerHTML = ''; 
                    return; 
                }
                
                const primeSelected = selection.streaming.service === addonsData.streaming.prime.name;
                const disneySelected = selection.disney.service !== null;
                
                let appOptions = '';
                pkg.apps.forEach(app => {
                    const isPermanentlyDisabled = (app === 'Amazon Prime' && primeSelected) || (app === 'Disney+ Est√°ndar' && disneySelected);
                    appOptions += `
                        <label class="flex items-center p-2 rounded-md transition-opacity ${isPermanentlyDisabled ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-700'}">
                            <input type="checkbox" name="package-app" value="${app}" class="custom-checkbox" 
                                ${isPermanentlyDisabled ? 'disabled data-permanently-disabled="true"' : ''}> 
                            <span class="ml-3">${app}</span>
                        </label>`;
                });
                
                container.innerHTML = `
                    <div class="ml-6 border-l-2 border-orange-700 pl-6 space-y-3">
                        <div class="flex justify-between items-center">
                            <p class="package-selection-counter font-semibold text-orange-300">Selecciona hasta ${pkg.limit} app${pkg.limit !== 1 ? 's' : ''}: (0/${pkg.limit})</p>
                            <p class="package-limit-message text-amber-400 text-sm font-semibold hidden">¬°L√≠mite alcanzado!</p>
                        </div>
                        <div class="limited-checkbox-group grid sm:grid-cols-2 gap-2" data-limit="${pkg.limit}">
                            ${appOptions}
                        </div>
                    </div>`;
            }

            function updateSummaryAndTotal() {
                if (!selection.plan) return;
                
                let total = selection.plan.price;
                let summaryHTML = `
                    <p><strong>Servicio:</strong> ${selection.planType === 'internet' ? 'Solo Internet' : 'Internet + TV'}</p>
                    <p><strong>Plan:</strong> ${selection.plan.promoMegas} Megas x 4 meses</p>
                    <p class="font-semibold">Precio Plan: $${selection.plan.price} por 5 meses</p>`;
                
                let addonsSummary = '';
                
                if (selection.streaming.price > 0) {
                    addonsSummary += `<li>${selection.streaming.tier ? `${selection.streaming.service} (${selection.streaming.tier})` : selection.streaming.service}: +$${selection.streaming.price}</li>`;
                    total += selection.streaming.price;
                }
                
                if (selection.disney.price > 0) {
                    addonsSummary += `<li>${selection.disney.tier ? `${selection.disney.service} (${selection.disney.tier})` : selection.disney.service}: +$${selection.disney.price}</li>`;
                    total += selection.disney.price;
                }
                
                if (selection.appPackage.price > 0) {
                    addonsSummary += `<li>${selection.appPackage.data.name}: +$${selection.appPackage.price}</li>`;
                    total += selection.appPackage.price;
                    
                    if (selection.appPackage.selectedApps.length > 0) {
                        addonsSummary += `<ul class="list-disc list-inside ml-4 text-orange-400">`;
                        selection.appPackage.selectedApps.forEach(app => {
                            addonsSummary += `<li>${app}</li>`;
                        });
                        addonsSummary += `</ul>`;
                    }
                }
                
                if (selection.devices.length > 0) {
                    selection.devices.forEach(device => {
                        addonsSummary += `<li>${device.name}: +$${device.price}</li>`;
                        total += device.price;
                    });
                }
                
                if (addonsSummary) {
                    summaryHTML += `
                        <div class="border-t border-orange-800 my-2"></div>
                        <p><strong>Adicionales:</strong></p>
                        <ul class="list-none space-y-1">
                            ${addonsSummary}
                        </ul>`;
                }
                
                // Calcular descuento por portabilidad (solo en periodo promocional)
                selection.portabilityDiscount = selection.portability && isPromoPeriod() ? portabilityDiscount[selection.planType] : 0;
                
                selection.total = total;
                
                // Pago inicial es el total mensual (la instalaci√≥n es $0)
                selection.installPrice = selection.total;
                
                dom.summaryContent.innerHTML = summaryHTML;
                dom.summaryTotal.textContent = `$${selection.total} por 5 meses`;
                dom.summaryInstall.textContent = `$0 (Valor $350)`;
                dom.summaryInstallPrice.textContent = `$${selection.installPrice}`;
            }
            
            function handlePlanSelection(e) {
                if (!e.target.classList.contains('select-plan-btn')) return;
                
                const { megas, promoMegas, price, regularPrice, promoPrice, lifetimeDiscount } = e.target.dataset;
                selection.plan = { 
                    megas: parseInt(megas), 
                    promoMegas: parseInt(promoMegas),
                    price: parseInt(price),
                    regularPrice: parseInt(regularPrice),
                    promoPrice: parseInt(promoPrice),
                    lifetimeDiscount: parseInt(lifetimeDiscount)
                };
                
                // Track event for Facebook Pixel
                trackFacebookEvent('AddToCart', {
                    content_name: `Plan ${selection.plan.megas} Megas - ${selection.planType}`,
                    content_ids: [`plan_${selection.planType}_${selection.plan.megas}`],
                    content_type: 'product',
                    value: selection.plan.price,
                    currency: 'MXN'
                });
                
                // Ocultar secciones no relevantes
                hideNonPlanSections();
                
                document.querySelector('#planes .text-center > .promo-gradient').classList.add('hidden');
                dom.planCardsContainer.classList.add('hidden');
                document.getElementById('plan-type-buttons').classList.add('hidden');
                
                dom.addonsSection.classList.remove('hidden');
                dom.addonsSection.scrollIntoView({ behavior: 'smooth' });
                
                updateSummaryAndTotal();
            }

            function handleAddonsEvents(e) {
                const { name, value, type } = e.target;
                
                if (name === 'streaming') {
                    const netflixTiers = document.getElementById('netflix-tiers');
                    selection.streaming = { service: null, tier: null, price: 0 };
                    
                    if (netflixTiers) {
                        Array.from(netflixTiers.querySelectorAll('input')).forEach(i => i.checked = false);
                    }
                    
                    if (value === 'prime') {
                        selection.streaming = { 
                            service: addonsData.streaming.prime.name, 
                            tier: null, 
                            price: addonsData.streaming.prime.price 
                        };
                        // Track event for Facebook Pixel
                        trackFacebookEvent('AddToCart', {
                            content_name: 'Amazon Prime',
                            content_ids: ['addon_prime'],
                            content_type: 'product',
                            value: addonsData.streaming.prime.price,
                            currency: 'MXN'
                        });
                    } else if (value === 'netflix') {
                        if (netflixTiers) netflixTiers.classList.remove('hidden');
                    } else {
                        if (netflixTiers) netflixTiers.classList.add('hidden');
                    }
                    
                    if (selection.appPackage.data) {
                        renderPackageApps(selection.appPackage.data.id);
                    }
                }
                
                if (name === 'netflix-tier') {
                    const tierData = addonsData.streaming.netflix.tiers.find(t => t.id === value);
                    selection.streaming = { 
                        service: addonsData.streaming.netflix.name, 
                        tier: tierData.name, 
                        price: tierData.price 
                    };
                    // Track event for Facebook Pixel
                    trackFacebookEvent('AddToCart', {
                        content_name: `Netflix - ${tierData.name}`,
                        content_ids: [`netflix_${tierData.id}`],
                        content_type: 'product',
                        value: tierData.price,
                        currency: 'MXN'
                    });
                }
                
                if (name === 'disney') {
                    selection.disney = { service: null, tier: null, price: 0 };
                    
                    if (value !== 'none') {
                        const tierData = addonsData.disney.tiers.find(t => t.id === value);
                        selection.disney = { 
                            service: addonsData.disney.name, 
                            tier: tierData.name, 
                            price: tierData.price 
                        };
                        // Track event for Facebook Pixel
                        trackFacebookEvent('AddToCart', {
                            content_name: `Disney+ - ${tierData.name}`,
                            content_ids: [`disney_${tierData.id}`],
                            content_type: 'product',
                            value: tierData.price,
                            currency: 'MXN'
                        });
                        
                        // Si selecciona Disney+, verificar si hay Disney+ en paquete de apps y desmarcarlo
                        if (selection.appPackage.data && selection.appPackage.selectedApps.includes('Disney+ Est√°ndar')) {
                            const index = selection.appPackage.selectedApps.indexOf('Disney+ Est√°ndar');
                            if (index > -1) {
                                selection.appPackage.selectedApps.splice(index, 1);
                                
                                // Actualizar checkboxes en la UI
                                const checkboxes = document.querySelectorAll('input[name="package-app"]');
                                checkboxes.forEach(cb => {
                                    if (cb.value === 'Disney+ Est√°ndar') {
                                        cb.checked = false;
                                    }
                                });
                                
                                // Actualizar contador
                                const group = document.querySelector('.limited-checkbox-group');
                                if (group) {
                                    const limit = parseInt(group.dataset.limit);
                                    const checkedCheckboxes = group.querySelectorAll('input[name="package-app"]:checked');
                                    const counterElement = group.parentElement.querySelector('.package-selection-counter');
                                    const messageElement = group.parentElement.querySelector('.package-limit-message');
                                    
                                    if (counterElement) {
                                        counterElement.textContent = `Selecciona hasta ${limit} app${limit !== 1 ? 's' : ''}: (${checkedCheckboxes.length}/${limit})`;
                                    }
                                    
                                    if (checkedCheckboxes.length < limit && messageElement) {
                                        messageElement.classList.add('hidden');
                                        group.querySelectorAll('input[name="package-app"]').forEach(cb => {
                                            if (cb.dataset.permanentlyDisabled !== 'true') {
                                                cb.disabled = false;
                                                cb.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
                                            }
                                        });
                                    }
                                }
                            }
                        }
                    }
                    
                    if (selection.appPackage.data) {
                        renderPackageApps(selection.appPackage.data.id);
                    }
                }
                
                if (name === 'app-package') {
                    selection.appPackage = { data: null, selectedApps: [], price: 0 };
                    
                    if (value !== 'none') {
                        const pkg = addonsData.app_packages.find(p => p.id === value);
                        selection.appPackage = { 
                            data: pkg, 
                            selectedApps: [], 
                            price: pkg.price 
                        };
                        // Track event for Facebook Pixel
                        trackFacebookEvent('AddToCart', {
                            content_name: pkg.name,
                            content_ids: [`package_${pkg.id}`],
                            content_type: 'product',
                            value: pkg.price,
                            currency: 'MXN'
                        });
                        
                        // Si selecciona un paquete que incluye Disney+ y ya tiene Disney+ seleccionado, desmarcar Disney+
                        if (pkg.apps.includes('Disney+ Est√°ndar') && selection.disney.service !== null) {
                            selection.disney = { service: null, tier: null, price: 0 };
                            
                            // Actualizar radio buttons de Disney en la UI
                            const disneyRadios = document.querySelectorAll('input[name="disney"]');
                            disneyRadios.forEach(radio => {
                                if (radio.value === 'none') {
                                    radio.checked = true;
                                } else {
                                    radio.checked = false;
                                }
                            });
                        }
                    } 
                    renderPackageApps(value);
                }
                
                if (name === 'package-app') {
                    const group = e.target.closest('.limited-checkbox-group');
                    if (!group) return;
                    
                    const limit = parseInt(group.dataset.limit);
                    const allCheckboxes = group.querySelectorAll('input[name="package-app"]');
                    const messageElement = group.parentElement.querySelector('.package-limit-message');
                    const counterElement = group.parentElement.querySelector('.package-selection-counter');
                    
                    const checkedCheckboxes = group.querySelectorAll('input[name="package-app"]:checked');
                    selection.appPackage.selectedApps = Array.from(checkedCheckboxes).map(cb => cb.value);
                    
                    if (counterElement) {
                        counterElement.textContent = `Selecciona hasta ${limit} app${limit !== 1 ? 's' : ''}: (${checkedCheckboxes.length}/${limit})`;
                    }
                    
                    // Si selecciona Disney+ en el paquete de apps, desmarcar Disney+ promocional
                    if (e.target.checked && e.target.value === 'Disney+ Est√°ndar' && selection.disney.service !== null) {
                        selection.disney = { service: null, tier: null, price: 0 };
                        
                        // Actualizar radio buttons de Disney en la UI
                        const disneyRadios = document.querySelectorAll('input[name="disney"]');
                        disneyRadios.forEach(radio => {
                            if (radio.value === 'none') {
                                radio.checked = true;
                            } else {
                                radio.checked = false;
                            }
                        });
                    }
                    
                    if (checkedCheckboxes.length >= limit) {
                        if (messageElement) messageElement.classList.remove('hidden');
                        
                        allCheckboxes.forEach(cb => {
                            if (!cb.checked) {
                                cb.disabled = true;
                                cb.parentElement.classList.add('opacity-50', 'cursor-not-allowed');
                            }
                        });
                    } else {
                        if (messageElement) messageElement.classList.add('hidden');
                        
                        allCheckboxes.forEach(cb => {
                            if (cb.dataset.permanentlyDisabled !== 'true') {
                                cb.disabled = false;
                                cb.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
                            }
                        });
                    }
                }
                
                if (name === 'device') {
                    selection.devices = Array.from(document.querySelectorAll('input[name="device"]:checked'))
                        .map(cb => Object.values(addonsData.devices).find(d => d.id === cb.value))
                        .filter(Boolean);
                    
                    // Track event for Facebook Pixel for each device
                    if (e.target.checked) {
                        const device = Object.values(addonsData.devices).find(d => d.id === e.target.value);
                        if (device) {
                            trackFacebookEvent('AddToCart', {
                                content_name: device.name,
                                content_ids: [`device_${device.id}`],
                                content_type: 'product',
                                value: device.price,
                                currency: 'MXN'
                            });
                        }
                    }
                }
                
                updateSummaryAndTotal();
            }

            function validateForm() {
                const isValid = Array.from(dom.formInputs).every(input => input.checkValidity());
                dom.btnContinue.disabled = !isValid;
            }

            // Funci√≥n para formatear los adicionales como texto
            function formatAdicionales() {
                let adicionalesText = '';
                
                if (selection.streaming.price > 0) {
                    adicionalesText += `Streaming: ${selection.streaming.tier ? `${selection.streaming.service} (${selection.streaming.tier})` : selection.streaming.service}`;
                }
                
                if (selection.disney.price > 0) {
                    if (adicionalesText) adicionalesText += ' | ';
                    adicionalesText += `Disney+: ${selection.disney.tier}`;
                }
                
                if (selection.appPackage.price > 0) {
                    if (adicionalesText) adicionalesText += ' | ';
                    adicionalesText += `Paquete Apps: ${selection.appPackage.data.name}`;
                    if (selection.appPackage.selectedApps.length > 0) {
                        adicionalesText += ` (${selection.appPackage.selectedApps.join(', ')})`;
                    }
                }
                
                if (selection.devices.length > 0) {
                    if (adicionalesText) adicionalesText += ' | ';
                    adicionalesText += `Dispositivos: ${selection.devices.map(d => d.name).join(', ')}`;
                }
                
                return adicionalesText || 'Ninguno';
            }

            // Funci√≥n para crear el resumen completo
            function crearResumenCompleto() {
                let resumen = `SERVICIO: ${selection.planType === 'internet' ? 'Solo Internet' : 'Internet + TV'}\n`;
                resumen += `PLAN: ${selection.plan.promoMegas} Megas x 4 meses - $${selection.plan.price}/mes por 5 meses\n`;
                resumen += `TOTAL MENSUAL: $${selection.total} por 5 meses\n`;
                
                if (selection.streaming.price > 0 || selection.disney.price > 0 || selection.appPackage.price > 0 || selection.devices.length > 0) {
                    resumen += `\nADICIONALES:\n`;
                    
                    if (selection.streaming.price > 0) {
                        resumen += `- ${selection.streaming.tier ? `${selection.streaming.service} (${selection.streaming.tier})` : selection.streaming.service}: $${selection.streaming.price}/mes\n`;
                    }
                    
                    if (selection.disney.price > 0) {
                        resumen += `- ${selection.disney.tier ? `${selection.disney.service} (${selection.disney.tier})` : selection.disney.service}: $${selection.disney.price}/mes\n`;
                    }
                    
                    if (selection.appPackage.price > 0) {
                        resumen += `- ${selection.appPackage.data.name}: $${selection.appPackage.price}/mes\n`;
                        if (selection.appPackage.selectedApps.length > 0) {
                            selection.appPackage.selectedApps.forEach(app => {
                                resumen += `  * ${app}\n`;
                            });
                        }
                    }
                    
                    if (selection.devices.length > 0) {
                        selection.devices.forEach(device => {
                            resumen += `- ${device.name}: $${device.price}/mes\n`;
                        });
                    }
                }
                
                resumen += `\nCOSTO DE INSTALACI√ìN EXTRA: $0 (Valor $350)\n`;
                
                if (selection.portability && isPromoPeriod()) {
                    const discountAmount = portabilityDiscount[selection.planType];
                    resumen += `DESEO HACER PORTABILIDAD PARA EL DESCUENTO DE: $${discountAmount} EN MI SEGUNDA MENSUALIDAD\n`;
                }
                
                resumen += `PAGO INICIAL: $${selection.installPrice}\n`;
                resumen += `FECHA: ${new Date().toLocaleString('es-MX')}`;
                
                return resumen;
            }

            async function sendDataToMake(formData) {
                try {
                    // Preparar datos para Google Sheets seg√∫n las columnas especificadas
                    const sheetsData = {
                        nombre: formData.nombre,
                        correo: formData.correo,
                        telefono: formData.telefono,
                        servicio: formData.servicio,
                        plan: formData.plan,
                        adicionales: formatAdicionales(),
                        opcion_regalo: `Instalaci√≥n $0 (Valor $350)`,
                        total_mensual: formData.total,
                        pago_inicial: formData.installPrice,
                        fecha: new Date().toLocaleString('es-MX'),
                        resumen: crearResumenCompleto()
                    };
                    
                    // Enviar datos a Make.com
                    const response = await fetch(MAKE_WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(sheetsData),
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Error enviando datos a Make.com:', error);
                    return null;
                }
            }

            async function submitAndRedirect() {
                // Validar que el formulario est√© completo antes de proceder
                const isFormValid = Array.from(dom.formInputs).every(input => input.checkValidity());
                if (!isFormValid) {
                    alert('Por favor completa todos los campos requeridos antes de continuar.');
                    return;
                }
                
                dom.continueText.classList.add('hidden');
                dom.continueLoader.classList.remove('hidden');
                dom.btnContinue.disabled = true;
                
                // A√±adir clase de loading al formulario
                dom.contactForm.classList.add('form-loading');

                const formData = {
                    nombre: document.getElementById('nombre').value,
                    correo: document.getElementById('correo').value,
                    telefono: document.getElementById('telefono').value,
                    servicio: selection.planType === 'internet' ? 'Solo Internet' : 'Internet + TV',
                    plan: `${selection.plan.promoMegas} Megas x 4 meses`,
                    precio_plan: selection.plan.price,
                    adicionales: {
                        streaming: selection.streaming.service ? {
                            servicio: selection.streaming.service,
                            plan: selection.streaming.tier,
                            precio: selection.streaming.price
                        } : null,
                        disney: selection.disney.service ? {
                            servicio: selection.disney.service,
                            plan: selection.disney.tier,
                            precio: selection.disney.price
                        } : null,
                        paquete_apps: selection.appPackage.data ? {
                            nombre: selection.appPackage.data.name,
                            apps_seleccionadas: selection.appPackage.selectedApps,
                            precio: selection.appPackage.price
                        } : null,
                        dispositivos: selection.devices.length > 0 ? selection.devices.map(d => ({
                            nombre: d.name,
                            precio: d.price
                        })) : []
                    },
                    total: selection.total,
                    installPrice: selection.installPrice,
                    portability: selection.portability,
                    portabilityDiscount: selection.portabilityDiscount
                };

                // Track event for Facebook Pixel - Purchase
                trackFacebookEvent('Purchase', {
                    value: selection.total,
                    currency: 'MXN',
                    content_ids: [`plan_${selection.planType}_${selection.plan.megas}`],
                    content_type: 'product'
                });

                // Track event for Facebook Pixel - Lead
                trackFacebookEvent('Lead', {
                    value: selection.total,
                    currency: 'MXN'
                });

                // Enviar datos a Make.com (en segundo plano, no esperamos la respuesta)
                sendDataToMake(formData).then(result => {
                    console.log('Datos enviados a Make.com:', result);
                }).catch(error => {
                    console.error('Error enviando a Make.com:', error);
                });

                // Construir mensaje para WhatsApp
                let message = `Hola, mi nombre es ${formData.nombre}.\n\nQuiero contratar el siguiente paquete:\n`;
                message += `*Servicio:* ${formData.servicio}\n`;
                message += `*Plan:* ${formData.plan} ($${formData.precio_plan} por 5 meses)\n\n`;
                
                if (formData.adicionales.streaming || formData.adicionales.disney || formData.adicionales.paquete_apps || formData.adicionales.dispositivos.length > 0) {
                    message += "Adicionales:\n";
                    
                    if (formData.adicionales.streaming) {
                        message += `- ${formData.adicionales.streaming.servicio}${formData.adicionales.streaming.plan ? ` (${formData.adicionales.streaming.plan})` : ''}: $${formData.adicionales.streaming.precio}\n`;
                    }
                    
                    if (formData.adicionales.disney) {
                        message += `- ${formData.adicionales.disney.servicio}${formData.adicionales.disney.plan ? ` (${formData.adicionales.disney.plan})` : ''}: $${formData.adicionales.disney.precio}\n`;
                    }
                    
                    if (formData.adicionales.paquete_apps) {
                        message += `- ${formData.adicionales.paquete_apps.nombre}: $${formData.adicionales.paquete_apps.precio}\n`;
                        if (formData.adicionales.paquete_apps.apps_seleccionadas.length > 0) {
                            formData.adicionales.paquete_apps.apps_seleccionadas.forEach(app => {
                                message += `  - ${app}\n`;
                            });
                        }
                    }
                    
                    if (formData.adicionales.dispositivos.length > 0) {
                        formData.adicionales.dispositivos.forEach(d => {
                            message += `- ${d.nombre}: $${d.precio}\n`;
                        });
                    }
                    
                    message += "\n";
                }
                
                message += `*Total mensual estimado: $${formData.total} por 5 meses*\n`;
                message += `*Costo de Instalaci√≥n Extra:* *$0 (Valor $350)*\n`;
                
                if (formData.portability && isPromoPeriod()) {
                    message += `*Deseo hacer portabilidad para el descuento de: $${formData.portabilityDiscount} en mi segunda mensualidad*\n`;
                }
                
                message += `\n*Total a pagar al t√©cnico ya instalado su servicio y activo:* *$${formData.installPrice}*\n\n`;
                message += `*Mis datos de contacto son:*\nCorreo: ${formData.correo}\nTel√©fono: ${formData.telefono}`;
                
                // Redirigir a WhatsApp
                const whatsappURL = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
                window.location.href = whatsappURL;
            }

            // --- EVENT LISTENERS ---
            
            dom.planTypeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    dom.planTypeButtons.forEach(btn => {
                        btn.classList.remove('bg-orange-600');
                        btn.classList.add('bg-transparent', 'hover:bg-orange-900');
                    });
                    button.classList.add('bg-orange-600');
                    button.classList.remove('bg-transparent', 'hover:bg-orange-900');
                    renderPlanCards(button.id.replace('btn-', ''));
                });
            });
            
            dom.planCardsContainer.addEventListener('click', handlePlanSelection);
            
            document.getElementById('btn-addons-yes').addEventListener('click', () => {
                // Track Personalizar producto event
                trackFacebookEvent('Personalizar producto', {
                    content_name: 'Add-ons Selection',
                    content_category: 'Customization'
                });
                
                dom.addonsIntro.classList.add('hidden');
                renderAddonsOptions();
                dom.contactSection.classList.remove('hidden');
                dom.addonsOptionsContainer.scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('btn-addons-no').addEventListener('click', () => {
                dom.addonsSection.classList.add('hidden');
                dom.contactSection.classList.remove('hidden');
                dom.contactSection.scrollIntoView({ behavior: 'smooth' });
            });

            dom.addonsOptionsContainer.addEventListener('change', handleAddonsEvents);
            dom.formInputs.forEach(input => input.addEventListener('input', validateForm));
            dom.btnContinue.addEventListener('click', submitAndRedirect);
            
            // Event listener para el checkbox de portabilidad
            dom.portabilityCheckbox.addEventListener('change', function() {
                selection.portability = this.checked;
                updateSummaryAndTotal();
            });
            
            // Event listener para el bot√≥n "Ver Planes"
            dom.verPlanesBtn.addEventListener('click', function(e) {
                e.preventDefault();
                hideNonPlanSections();
                document.getElementById('planes').scrollIntoView({ behavior: 'smooth' });
            });

            // --- INICIALIZACI√ìN ---
            setPromoDate();
            renderPlanCards('internet');
            createFloatingEmojis();
        });
    </script>
</body>
</html>