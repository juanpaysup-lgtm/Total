<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesor Juan Mel√©ndez - Contrata Totalplay Fibra √ìptica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1766933083922039');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1766933083922039&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .hero-gradient {
            background: linear-gradient(90deg, rgba(30, 41, 59, 0.95) 0%, rgba(17, 24, 39, 0.9) 50%, rgba(0,0,0,0.7) 100%), url('https://images.unsplash.com/photo-1563014959-7aaa83350992?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80') center center/cover no-repeat;
        }
        .promo-gradient {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
        }
        .recommended-badge {
            position: absolute;
            top: -1px;
            right: 1.5rem;
            background-color: #f59e0b;
            color: #111827;
            padding: 0.25rem 0.75rem;
            border-radius: 0 0 0.5rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .custom-checkbox:checked, .custom-radio:checked {
            background-color: #4f46e5;
            border-color: #6d28d9;
        }
        .fade-out {
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: opacity 0.5s ease, height 0.5s ease;
        }
        .fade-in {
            opacity: 1;
            height: auto;
            overflow: visible;
            transition: opacity 0.5s ease, height 0.5s ease;
        }
        .section-hidden {
            display: none;
        }
        .form-loading {
            position: relative;
            pointer-events: none;
        }
        .form-loading::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
        }
        .discount-badge {
            background-color: #10b981;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        .disney-promo {
            background: linear-gradient(135deg, #113ccf 0%, #3500b1 100%);
            border-left: 4px solid #f5c211;
        }
        .promo-tag {
            background-color: #f59e0b;
            color: #111827;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body class="bg-slate-900 text-white">

    <!-- Header -->
    <header class="bg-slate-800/80 backdrop-blur-sm sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-xl md:text-2xl font-bold text-white">
                <span class="text-indigo-400">Asesor Autorizado</span> Totalplay¬Æ
            </div>
            <div class="text-right">
                <p class="font-semibold">Juan Mel√©ndez</p>
                <p class="text-sm text-slate-400">Tu experto en conectividad</p>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <main class="container mx-auto px-6">
        <section id="inicio" class="min-h-[80vh] flex items-center hero-gradient rounded-3xl mt-8 p-8 md:p-16">
            <div class="max-w-3xl">
                <h1 class="text-4xl md:text-6xl font-extrabold text-white leading-tight">
                    La ultra velocidad sim√©trica de la Fibra √ìptica, <span class="text-indigo-400">directo a tu hogar.</span>
                </h1>
                <p class="mt-6 text-lg text-slate-300">
                    Instalaci√≥n express sin costo, precio fijo por 12 meses y descuentos exclusivos al contratar hoy.
                </p>
                <div id="promo-banner" class="mt-8 bg-white/10 p-4 rounded-xl border border-slate-700">
                    <p class="text-center font-bold text-yellow-300 text-lg">
                        üî• ¬°Ofertas por tiempo limitado! V√°lido hasta <span id="current-day"></span>.
                    </p>
                </div>
                <a href="#planes" id="ver-planes-btn" class="mt-10 inline-block bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-lg py-4 px-10 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-300">
                    Ver Planes
                </a>
            </div>
        </section>

        <!-- Benefits Section -->
        <section id="beneficios" class="py-20">
            <h2 class="text-3xl font-bold text-center mb-12">Beneficios Exclusivos al Contratar</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-indigo-400 mb-3">Velocidad Sim√©trica</h3>
                    <p class="text-slate-400">Disfruta la misma velocidad para subir y descargar archivos. Ideal para home office, clases en l√≠nea y gaming.</p>
                </div>
                <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-indigo-400 mb-3">Precio Fijo Garantizado</h3>
                    <p class="text-slate-400">Te mantenemos el mismo precio durante 12 meses al realizar tu pago puntual. Sin sorpresas en your factura.</p>
                </div>
                <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-indigo-400 mb-3">Soporte T√©cnico Prioritario</h3>
                    <p class="text-slate-400">Accede a nuestra l√≠nea de atenci√≥n t√©cnica 24/7 con asesores listos para resolver cualquier inconveniente r√°pidamente.</p>
                </div>
                <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 transform hover:-translate-y-2 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-indigo-400 mb-3">Instalaci√≥n Sin Costo</h3>
                    <p class="text-slate-400">Instalaci√≥n profesional incluida con valor de $350 MXN. Paga hoy $0 por la instalaci√≥n de tu servicio.</p>
                </div>
            </div>
        </section>
        
        <!-- Plans Section -->
        <section id="planes" class="py-20">
            <div class="text-center">
                 <div class="promo-gradient p-8 rounded-2xl mb-12 shadow-2xl">
                    <h2 class="text-4xl font-extrabold text-white">Elige el plan ideal para ti</h2>
                    <p class="text-indigo-200 mt-2 text-lg">Todos nuestros planes cuentan con velocidad sim√©trica e instalaci√≥n sin costo.</p>
                </div>

                <div id="plan-type-buttons" class="flex justify-center gap-4 mb-10 bg-slate-800 p-2 rounded-full max-w-md mx-auto">
                    <button id="btn-internet" class="plan-type-btn flex-1 bg-indigo-600 text-white font-bold py-3 px-8 rounded-full transition-colors duration-300">Solo Internet</button>
                    <button id="btn-combo" class="plan-type-btn flex-1 bg-transparent hover:bg-slate-700 text-white font-bold py-3 px-8 rounded-full transition-colors duration-300">Internet + TV</button>
                </div>

                <div id="plan-cards-container" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
                    <!-- Las tarjetas de planes se insertar√°n aqu√≠ con JS -->
                </div>
            </div>
        </section>

        <!-- Add-ons Section -->
        <section id="addons-section" class="hidden py-12">
             <div id="addons-intro" class="max-w-3xl mx-auto text-center bg-slate-800 rounded-3xl p-8 md:p-12">
                <h2 class="text-3xl font-bold mb-4">¬°Personaliza tu paquete!</h2>
                <p class="text-slate-400 mb-8">¬øDeseas agregar servicios de streaming, apps o dispositivos a tu plan?</p>
                 <div class="flex justify-center gap-4">
                    <button id="btn-addons-yes" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-10 rounded-full transition-colors duration-300">¬°S√≠, agregar!</button>
                    <button id="btn-addons-no" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-10 rounded-full transition-colors duration-300">No, gracias</button>
                </div>
            </div>
            
            <div id="addons-options" class="hidden max-w-4xl mx-auto mt-12 space-y-10">
                <!-- Las opciones de adicionales se insertar√°n aqu√≠ -->
            </div>
        </section>

        <!-- Contact Form & Summary Section -->
        <section id="contact-section" class="hidden py-20">
            <div class="max-w-4xl mx-auto bg-slate-800 p-8 md:p-12 rounded-3xl border border-slate-700 grid md:grid-cols-2 gap-12">
                <div>
                    <h2 class="text-3xl font-bold mb-2 text-indigo-400">¬°Casi listo!</h2>
                    <p class="text-slate-400 mb-6">Completa tus datos para finalizar tu solicitud. Me pondr√© en contacto contigo a la brevedad para coordinar la instalaci√≥n.</p>
                    <form id="contact-form">
                        <div class="mb-4">
                            <label for="nombre" class="block mb-2 text-sm font-medium text-slate-300">Nombre Completo</label>
                            <input type="text" id="nombre" name="nombre" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5" placeholder="Tu nombre" required>
                        </div>
                        <div class="mb-4">
                            <label for="correo" class="block mb-2 text-sm font-medium text-slate-300">Correo Electr√≥nico</label>
                            <input type="email" id="correo" name="correo" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5" placeholder="tu@correo.com" required>
                        </div>
                        <div class="mb-6">
                            <label for="telefono" class="block mb-2 text-sm font-medium text-slate-300">Tel√©fono (WhatsApp)</label>
                            <input type="tel" id="telefono" name="telefono" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5" placeholder="10 d√≠gitos" required pattern="\d{10}">
                        </div>
                        <div class="mb-6">
                            <label class="flex items-center">
                                <input type="checkbox" id="portabilidad" name="portabilidad" class="custom-checkbox rounded">
                                <span class="ml-2 text-slate-300">¬øDeseas portar tu n√∫mero? (Obt√©n descuento en tu segunda mensualidad)</span>
                            </label>
                        </div>
                    </form>
                </div>
                <div class="bg-slate-900 p-6 rounded-2xl flex flex-col">
                    <h3 class="text-xl font-bold mb-4">Resumen de tu pedido</h3>
                    <div id="summary-content" class="space-y-3 text-slate-300 flex-grow">
                        <!-- El resumen se insertar√° aqu√≠ con JS -->
                    </div>
                     <div class="border-t border-slate-700 mt-4 pt-4">
                        <div class="flex justify-between items-center text-xl font-bold">
                            <span>Total Mensual:</span>
                            <span id="summary-total" class="text-indigo-400">$0</span>
                        </div>
                        <div class="flex justify-between items-center text-lg text-green-400 mt-2">
                            <span>Costo de Instalaci√≥n Extra:</span>
                            <span id="summary-install" class="text-green-400">$0 (Valor $350)</span>
                        </div>
                        <div class="flex justify-between items-center text-xl font-bold mt-2 pt-2 border-t border-slate-700">
                            <span>Pago Inicial:</span>
                            <span id="summary-install-price" class="text-indigo-400">$0</span>
                        </div>
                    </div>
                    <button id="btn-continue" type="button" class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full transition-colors duration-300 disabled:bg-slate-600 disabled:cursor-not-allowed flex items-center justify-center gap-2" disabled>
                        <span id="continue-text">Enviar solicitud por WhatsApp</span>
                        <div id="continue-loader" class="hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </button>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section id="testimonios" class="py-20">
            <h2 class="text-3xl font-bold text-center mb-12">Lo que dicen nuestros clientes</h2>
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700">
                    <p class="text-slate-400 mb-6">"La atenci√≥n de Juan fue excelente. Me explic√≥ todo con claridad y la instalaci√≥n fue s√∫per r√°pida. Internet vuela, 100% recomendado!"</p>
                    <div class="font-bold text-right">- Sof√≠a G.</div>
                </div>
                <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700">
                    <p class="text-slate-400 mb-6">"Ten√≠a muchas dudas sobre qu√© plan me conven√≠a para mis clases en l√≠nea y para jugar. El asesor me ayud√≥ a elegir el paquete perfecto y ahora todo funciona de maravilla."</p>
                    <div class="font-bold text-right">- Carlos M.</div>
                </div>
                <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700">
                    <p class="text-slate-400 mb-6">"Contratar fue muy sencillo y sin tanto rollo. Me gustaron las promociones que me ofreci√≥ y el servicio ha sido muy estable desde el primer d√≠a."</p>
                    <div class="font-bold text-right">- Laura V.</div>
                </div>
            </div>
        </section>
        
        <!-- Support Section -->
        <section id="soporte" class="py-20 text-center">
            <div class="bg-slate-800 max-w-2xl mx-auto p-8 rounded-2xl border border-slate-700">
                <h2 class="text-2xl font-bold mb-4">¬øNecesitas Soporte T√©cnico?</h2>
                <p class="text-slate-400 mb-4">Si ya eres cliente y presentas una falla, comun√≠cate directamente a la l√≠nea de soporte t√©cnico para una atenci√≥n inmediata.</p>
                <p class="text-3xl font-bold text-indigo-400 tracking-widest">800 510 0510</p>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 mt-20">
        <div class="container mx-auto px-6 py-8 text-center text-slate-400">
            <p>&copy; <span id="current-year"></span> Juan Mel√©ndez - Asesor Autorizado Totalplay. Todos los derechos reservados.</p>
            <p class="text-sm mt-2">Este sitio es gestionado por un asesor de ventas autorizado. Totalplay¬Æ es una marca registrada.</p>
             <p class="text-xs mt-4">P√°gina creada por Juan Mel√©ndez</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- CONFIGURATION ---
            const WHATSAPP_NUMBER = '5218131191393'; // Replace with your number
            const MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/jigm042t5atf3tci3j82n3cxysiva3f0'; // Webhook de Make.com
            
            // Datos de portabilidad
            const portabilityDiscount = {
                'internet': 100, // $100 de descuento para planes de Solo Internet
                'combo': 200     // $200 de descuento para planes de Internet + TV
            };
            
            // Eventos personalizados para Facebook Pixel
            function trackFacebookEvent(eventName, parameters) {
                if (typeof fbq !== 'undefined') {
                    fbq('track', eventName, parameters);
                }
            }
            
            // Track time on page events
            setTimeout(() => {
                trackFacebookEvent('TimeOnPage30', {
                    content_name: document.title,
                    content_category: 'Page Engagement'
                });
            }, 30000);

            setTimeout(() => {
                trackFacebookEvent('TimeOnPage60', {
                    content_name: document.title,
                    content_category: 'Page Engagement'
                });
            }, 60000);

            setTimeout(() => {
                trackFacebookEvent('TimeOnPage120', {
                    content_name: document.title,
                    content_category: 'Page Engagement'
                });
            }, 120000);
            
            // --- PLANS AND ADD-ONS DATA ---
            const plansData = {
                internet: [
                    { 
                        megas: 100, 
                        promoMegas: 200,
                        regularPrice: 510,
                        promoPrice: 460, 
                        desc: "Fibra √≥ptica + Club WiFi Totalplay", 
                        recommended: false,
                        discount3to5: 20,
                        lifetimeDiscount: 20
                    },
                    { 
                        megas: 200, 
                        promoMegas: 300,
                        regularPrice: 620,
                        promoPrice: 570, 
                        desc: "Fibra √≥ptica + Club WiFi + Apple TV+ 1 a√±o", 
                        recommended: true,
                        discount3to5: 20,
                        lifetimeDiscount: 20
                    },
                    { 
                        megas: 300, 
                        promoMegas: 500,
                        regularPrice: 730,
                        promoPrice: 680, 
                        desc: "Fibra √≥ptica + Club WiFi + Apple TV+ 1 a√±o", 
                        recommended: false,
                        discount3to5: 30,
                        lifetimeDiscount: 30
                    },
                    { 
                        megas: 500, 
                        promoMegas: 1200,
                        regularPrice: 880,
                        promoPrice: 830, 
                        desc: "Fibra √≥ptica + WiFi 6 + Club WiFi + Apple TV+ 1 a√±o", 
                        recommended: false,
                        discount3to5: 50,
                        lifetimeDiscount: 60
                    },
                    { 
                        megas: 1200, 
                        promoMegas: 1200,
                        regularPrice: 1550,
                        promoPrice: 1470, 
                        desc: "Fibra √≥ptica + WiFi 6 + Club WiFi + Apple TV+ 1 a√±o", 
                        recommended: false,
                        discount3to5: 80,
                        lifetimeDiscount: 80
                    }
                ],
                combo: [
                    { 
                        megas: 100, 
                        promoMegas: 200,
                        regularPrice: 650,
                        promoPrice: 600, 
                        desc: "185 canales + Convertidor Smart TV", 
                        recommended: false,
                        discount3to5: 30,
                        lifetimeDiscount: 30
                    },
                    { 
                        megas: 200, 
                        promoMegas: 300,
                        regularPrice: 760,
                        promoPrice: 710, 
                        desc: "185 canales + Convertidor Smart TV + Alexa + Apple TV+ 1 a√±o", 
                        recommended: true,
                        discount3to5: 30,
                        lifetimeDiscount: 30
                    },
                    { 
                        megas: 300, 
                        promoMegas: 500,
                        regularPrice: 870,
                        promoPrice: 820, 
                        desc: "185 canales + Convertidor Smart TV + Alexa + Apple TV+ 1 a√±o", 
                        recommended: false,
                        discount3to5: 40,
                        lifetimeDiscount: 40
                    },
                    { 
                        megas: 500, 
                        promoMegas: 1200,
                        regularPrice: 1050,
                        promoPrice: 1000, 
                        desc: "185 canales + Convertidor Smart TV + Alexa + Bocinas B&O + Apple TV+ 1 a√±o", 
                        recommended: false,
                        discount3to5: 50,
                        lifetimeDiscount: 50
                    },
                    { 
                        megas: 1200, 
                        promoMegas: 1200,
                        regularPrice: 1720,
                        promoPrice: 1640, 
                        desc: "185 canales + Convertidor Smart TV + Alexa + Bocinas B&O + Apple TV+ 1 a√±o", 
                        recommended: false,
                        discount3to5: 100,
                        lifetimeDiscount: 100
                    }
                ]
            };

            const addonsData = {
                streaming: {
                    prime: { id: 'prime', name: 'Amazon Prime', price: 90 },
                    netflix: {
                        id: 'netflix', name: 'Netflix', tiers: [
                            { id: 'netflix-anuncios', name: 'Netflix con Anuncios', price: 110 },
                            { id: 'netflix-estandar', name: 'Netflix Est√°ndar (2 pantallas)', price: 229 },
                            { id: 'netflix-premium', name: 'Netflix Premium (4 pantallas)', price: 299 },
                        ]
                    }
                },
                disney: {
                    id: 'disney', 
                    name: 'Disney+', 
                    tiers: [
                        { 
                            id: 'disney-estandar', 
                            name: 'Disney+ Est√°ndar', 
                            price: 89, 
                            promo: '4 meses', 
                            regularPrice: 249, 
                            description: 'Para 2 dispositivos a la vez sin publicidad' 
                        },
                        { 
                            id: 'disney-premium', 
                            name: 'Disney+ Premium', 
                            price: 95, 
                            promo: '4 meses', 
                            regularPrice: 319, 
                            description: 'Para 4 dispositivos a la vez sin publicidad' 
                        }
                    ]
                },
                app_packages: [
                    { id: 'paq-basico', name: 'Paquete 2 Apps B√°sicas', price: 199, limit: 2, apps: [ 'Amazon Prime', 'HBO con Anuncios', 'Paramount+' ] },
                    { id: 'paq-estandar-2', name: 'Paquete 2 Apps Est√°ndar', price: 399, limit: 2, apps: [ 'Fox Sports Premium', 'NBA League Pass', 'HBO MAX', 'Disney+ Est√°ndar' ] },
                    { id: 'paq-estandar-3', name: 'Paquete 3 Apps Est√°ndar', price: 599, limit: 3, apps: [ 'Fox Sports Premium', 'NBA League Pass', 'HBO MAX', 'Disney+ Est√°ndar' ] },
                ],
                devices: {
                    wifiPro: { id: 'wifi-pro', name: 'WifiPro', price: 69, tvOnly: false },
                    tvAdicional: { id: 'tv-adicional', name: 'TV Adicional', price: 129, tvOnly: true },
                    tvAdicionalAlexa: { id: 'tv-adicional-alexa', name: 'TV Adicional con Alexa', price: 280, tvOnly: true },
                    sonidoSurround: { id: 'sonido-surround', name: 'Sonido Surround', price: 199, tvOnly: true }
                }
            };
            
            // --- APPLICATION STATE ---
            let selection = {
                plan: null, 
                planType: 'internet',
                streaming: { service: null, tier: null, price: 0 },
                disney: { service: null, tier: null, price: 0 },
                appPackage: { data: null, selectedApps: [], price: 0 },
                devices: [], 
                total: 0,
                portability: false,
                installPrice: 350,
                portabilityDiscount: 0
            };

            // --- DOM ELEMENTS ---
            const dom = {
                planCardsContainer: document.getElementById('plan-cards-container'),
                addonsSection: document.getElementById('addons-section'),
                addonsIntro: document.getElementById('addons-intro'),
                addonsOptionsContainer: document.getElementById('addons-options'),
                contactSection: document.getElementById('contact-section'),
                contactForm: document.getElementById('contact-form'),
                btnContinue: document.getElementById('btn-continue'),
                formInputs: document.querySelectorAll('#contact-form input'),
                summaryContent: document.getElementById('summary-content'),
                summaryTotal: document.getElementById('summary-total'),
                summaryInstall: document.getElementById('summary-install'),
                summaryInstallPrice: document.getElementById('summary-install-price'),
                continueText: document.getElementById('continue-text'),
                continueLoader: document.getElementById('continue-loader'),
                planTypeButtons: document.querySelectorAll('.plan-type-btn'),
                beneficiosSection: document.getElementById('beneficios'),
                testimoniosSection: document.getElementById('testimonios'),
                soporteSection: document.getElementById('soporte'),
                inicioSection: document.getElementById('inicio'),
                verPlanesBtn: document.getElementById('ver-planes-btn'),
                portabilityCheckbox: document.getElementById('portabilidad')
            };

            // --- FUNCTIONS ---

            function setPromoDate() {
                const dayElement = document.getElementById('current-day');
                const today = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                dayElement.textContent = today.toLocaleDateString('es-ES', options);
                document.getElementById('current-year').textContent = today.getFullYear();
            }

            function hideNonPlanSections() {
                // Ocultar secciones que no son relevantes para el proceso de contrataci√≥n
                dom.beneficiosSection.classList.add('section-hidden');
                dom.testimoniosSection.classList.add('section-hidden');
                dom.soporteSection.classList.add('section-hidden');
                dom.inicioSection.classList.add('fade-out');
                
                // Asegurarse de que las secciones de planes sean visibles
                document.getElementById('planes').classList.remove('section-hidden');
                document.getElementById('planes').scrollIntoView({ behavior: 'smooth' });
                
                // Track event for Facebook Pixel
                trackFacebookEvent('ViewContent', {
                    content_name: 'Planes de Internet',
                    content_category: 'Internet Plans'
                });
            }

            function renderPlanCards(type) {
                selection.planType = type;
                dom.planCardsContainer.innerHTML = '';
                plansData[type].forEach(plan => {
                    const isPromoActive = new Date() <= new Date('2025-09-30');
                    const currentMegas = isPromoActive ? plan.promoMegas : plan.megas;
                    const currentPrice = isPromoActive ? plan.promoPrice : plan.regularPrice;
                    
                    // Verificar si estamos en el per√≠odo de mostrar Descuento Mes Patrio
                    const today = new Date();
                    const showPatrioDiscount = today >= new Date('2025-09-17') && today <= new Date('2025-09-30');
                    
                    const card = `
                        <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 text-center flex flex-col relative">
                            ${plan.recommended ? '<div class="recommended-badge">Recomendado</div>' : ''}
                            <h3 class="text-3xl font-bold text-indigo-400">${currentMegas} Megas ${isPromoActive && currentMegas > plan.megas ? 'x 4 meses' : ''}</h3>
                            <p class="text-sm font-semibold text-green-400 mt-1">Internet Sim√©trico</p>
                            ${isPromoActive && currentMegas > plan.megas ? 
                                `<p class="text-sm font-semibold text-green-400 mt-1">Despu√©s: ${plan.megas} Megas</p>` : 
                                `<p class="text-sm font-semibold text-green-400 mt-1">Velocidad Sim√©trica</p>`
                            }
                            <p class="text-slate-400 mt-4 flex-grow min-h-[6rem]">${plan.desc}</p>
                            <div class="my-6">
                                <span class="text-4xl font-extrabold text-white ml-2">$${currentPrice}</span>
                                <span class="text-slate-400">/mes</span>
                                ${isPromoActive ? `<div class="text-sm text-slate-400 line-through">Precio regular: $${plan.regularPrice}</div>` : ''}
                            </div>
                            <div class="text-xs text-slate-400 mb-4 space-y-1">
                                ${showPatrioDiscount ? `<div>‚úÖ <strong>Descuento Mes Patrio:</strong> $${plan.discount3to5} del 3ro al 5to mes</div>` : ''}
                                <div>‚úÖ <strong>Descuento de por vida:</strong> $${plan.lifetimeDiscount} a partir del 6to mes</div>
                                <div>‚úÖ <strong>Instalaci√≥n:</strong> $350 (hoy $0)</div>
                            </div>
                            <button class="select-plan-btn mt-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full w-full transition-colors duration-300"
                                data-megas="${plan.megas}" data-promo-megas="${currentMegas}" data-price="${currentPrice}" data-regular-price="${plan.regularPrice}" data-discount3to5="${plan.discount3to5}" data-lifetime-discount="${plan.lifetimeDiscount}">
                                Seleccionar Plan
                            </button>
                        </div>
                    `;
                    dom.planCardsContainer.innerHTML += card;
                });
            }

            function renderAddonsOptions() {
                const { streaming, disney, app_packages, devices } = addonsData;
                const isTvPlan = selection.planType === 'combo';
                
                let streamingOptions = `
                    <label class="flex items-center p-3 bg-slate-700 rounded-lg has-[:checked]:bg-indigo-900/50 border-2 border-transparent has-[:checked]:border-indigo-500">
                        <input type="radio" name="streaming" value="none" class="custom-radio" checked> 
                        <span class="ml-3">Ninguno</span>
                    </label>
                    <label class="flex items-center p-3 bg-slate-700 rounded-lg has-[:checked]:bg-indigo-900/50 border-2 border-transparent has-[:checked]:border-indigo-500">
                        <input type="radio" name="streaming" value="prime" class="custom-radio"> 
                        <span class="ml-3">${streaming.prime.name} (+$${streaming.prime.price})</span>
                    </label>
                    <label class="flex items-center p-3 bg-slate-700 rounded-lg has-[:checked]:bg-indigo-900/50 border-2 border-transparent has-[:checked]:border-indigo-500">
                        <input type="radio" name="streaming" value="netflix" class="custom-radio"> 
                        <span class="ml-3">${streaming.netflix.name}</span>
                    </label>`;
                
                let netflixTiers = '';
                streaming.netflix.tiers.forEach(tier => {
                    netflixTiers += `
                        <label class="flex items-center">
                            <input type="radio" name="netflix-tier" value="${tier.id}" class="custom-radio"> 
                            <span class="ml-3">${tier.name} (+$${tier.price})</span>
                        </label>`;
                });
                
                let disneyOptions = `
                    <label class="flex items-center p-3 bg-slate-700 rounded-lg has-[:checked]:bg-indigo-900/50 border-2 border-transparent has-[:checked]:border-indigo-500">
                        <input type="radio" name="disney" value="none" class="custom-radio" checked> 
                        <span class="ml-3">Ninguno</span>
                    </label>`;
                
                disney.tiers.forEach(tier => {
                    disneyOptions += `
                        <label class="flex items-center p-3 bg-slate-700 rounded-lg has-[:checked]:bg-indigo-900/50 border-2 border-transparent has-[:checked]:border-indigo-500">
                            <input type="radio" name="disney" value="${tier.id}" class="custom-radio"> 
                            <span class="ml-3">${tier.name} (+$${tier.price} por ${tier.promo})</span>
                        </label>
                        <div class="disney-promo p-3 rounded-lg mb-3 ml-6">
                            <p class="text-sm text-white">${tier.description}. A partir del 5to mes: $${tier.regularPrice}</p>
                        </div>`;
                });
                
                let appPackageOptions = '';
                app_packages.forEach(pkg => {
                    appPackageOptions += `
                        <label class="flex items-center p-3 bg-slate-700 rounded-lg has-[:checked]:bg-indigo-900/50 border-2 border-transparent has-[:checked]:border-indigo-500">
                            <input type="radio" name="app-package" value="${pkg.id}" class="custom-radio">
                            <span class="ml-3">${pkg.name} (+$${pkg.price})</span>
                        </label>`;
                });
                
                let deviceOptions = '';
                Object.values(devices).forEach(device => {
                    if (!device.tvOnly || isTvPlan) {
                        deviceOptions += `
                            <label class="flex items-center p-3 bg-slate-700 rounded-lg has-[:checked]:bg-indigo-900/50 border-2 border-transparent has-[:checked]:border-indigo-500">
                                <input type="checkbox" name="device" value="${device.id}" class="custom-checkbox"> 
                                <span class="ml-3">${device.name} (+$${device.price})</span>
                            </label>`;
                    }
                });
                
                dom.addonsOptionsContainer.innerHTML = `
                    <div class="bg-slate-800 p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">1. Elige una plataforma de Streaming (opcional)</h3>
                        <div class="space-y-3" id="streaming-choice">
                            ${streamingOptions}
                        </div>
                        <div id="netflix-tiers" class="hidden mt-4 ml-6 space-y-3 border-l-2 border-slate-600 pl-6">
                            ${netflixTiers}
                        </div>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">2. Elige Disney+ (opcional)</h3>
                        <div class="space-y-3" id="disney-choice">
                            ${disneyOptions}
                        </div>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">3. Elige un paquete de Apps (opcional)</h3>
                        <div class="space-y-3" id="package-choice">
                            <label class="flex items-center p-3 bg-slate-700 rounded-lg has-[:checked]:bg-indigo-900/50 border-2 border-transparent has-[:checked]:border-indigo-500">
                                <input type="radio" name="app-package" value="none" class="custom-radio" checked> 
                                <span class="ml-3">Ninguno</span>
                            </label>
                            ${appPackageOptions}
                        </div>
                        <div id="package-apps-container" class="mt-4"></div>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">4. Agrega Dispositivos (opcional)</h3>
                        <div class="space-y-3" id="device-choice">
                            ${deviceOptions}
                        </div>
                    </div>`;
                
                dom.addonsOptionsContainer.classList.remove('hidden');
            }

            function renderPackageApps(packageId) {
                const container = document.getElementById('package-apps-container');
                const pkg = addonsData.app_packages.find(p => p.id === packageId);
                if (!pkg) { 
                    container.innerHTML = ''; 
                    return; 
                }
                
                const primeSelected = selection.streaming.service === addonsData.streaming.prime.name;
                const disneySelected = selection.disney.service !== null;
                
                let appOptions = '';
                pkg.apps.forEach(app => {
                    const isPermanentlyDisabled = (app === 'Amazon Prime' && primeSelected) || (app === 'Disney+ Est√°ndar' && disneySelected);
                    appOptions += `
                        <label class="flex items-center p-2 rounded-md transition-opacity ${isPermanentlyDisabled ? 'opacity-50 cursor-not-allowed' : 'hover:bg-slate-600'}">
                            <input type="checkbox" name="package-app" value="${app}" class="custom-checkbox" 
                                ${isPermanentlyDisabled ? 'disabled data-permanently-disabled="true"' : ''}> 
                            <span class="ml-3">${app}</span>
                        </label>`;
                });
                
                container.innerHTML = `
                    <div class="ml-6 border-l-2 border-slate-600 pl-6 space-y-3">
                        <div class="flex justify-between items-center">
                            <p class="package-selection-counter font-semibold text-slate-300">Selecciona hasta ${pkg.limit} app${pkg.limit !== 1 ? 's' : ''}: (0/${pkg.limit})</p>
                            <p class="package-limit-message text-amber-400 text-sm font-semibold hidden">¬°L√≠mite alcanzado!</p>
                        </div>
                        <div class="limited-checkbox-group grid sm:grid-cols-2 gap-2" data-limit="${pkg.limit}">
                            ${appOptions}
                        </div>
                    </div>`;
            }

            function updateSummaryAndTotal() {
                if (!selection.plan) return;
                
                let total = selection.plan.price;
                let summaryHTML = `
                    <p><strong>Servicio:</strong> ${selection.planType === 'internet' ? 'Solo Internet' : 'Internet + TV'}</p>
                    <p><strong>Plan:</strong> ${selection.plan.promoMegas} Megas x 4 meses</p>
                    <p class="font-semibold">Precio Plan: $${selection.plan.price}</p>`;
                
                let addonsSummary = '';
                
                if (selection.streaming.price > 0) {
                    addonsSummary += `<li>${selection.streaming.tier ? `${selection.streaming.service} (${selection.streaming.tier})` : selection.streaming.service}: +$${selection.streaming.price}</li>`;
                    total += selection.streaming.price;
                }
                
                if (selection.disney.price > 0) {
                    addonsSummary += `<li>${selection.disney.tier ? `${selection.disney.service} (${selection.disney.tier})` : selection.disney.service}: +$${selection.disney.price}</li>`;
                    total += selection.disney.price;
                }
                
                if (selection.appPackage.price > 0) {
                    addonsSummary += `<li>${selection.appPackage.data.name}: +$${selection.appPackage.price}</li>`;
                    total += selection.appPackage.price;
                    
                    if (selection.appPackage.selectedApps.length > 0) {
                        addonsSummary += `<ul class="list-disc list-inside ml-4 text-slate-400">`;
                        selection.appPackage.selectedApps.forEach(app => {
                            addonsSummary += `<li>${app}</li>`;
                        });
                        addonsSummary += `</ul>`;
                    }
                }
                
                if (selection.devices.length > 0) {
                    selection.devices.forEach(device => {
                        addonsSummary += `<li>${device.name}: +$${device.price}</li>`;
                        total += device.price;
                    });
                }
                
                if (addonsSummary) {
                    summaryHTML += `
                        <div class="border-t border-slate-700 my-2"></div>
                        <p><strong>Adicionales:</strong></p>
                        <ul class="list-none space-y-1">
                            ${addonsSummary}
                        </ul>`;
                }
                
                // Calcular descuento por portabilidad
                selection.portabilityDiscount = selection.portability ? portabilityDiscount[selection.planType] : 0;
                
                selection.total = total;
                
                // Pago inicial es el total mensual (la instalaci√≥n es $0)
                selection.installPrice = selection.total;
                
                dom.summaryContent.innerHTML = summaryHTML;
                dom.summaryTotal.textContent = `$${selection.total}`;
                dom.summaryInstall.textContent = `$0 (Valor $350)`;
                dom.summaryInstallPrice.textContent = `$${selection.installPrice}`;
            }
            
            function handlePlanSelection(e) {
                if (!e.target.classList.contains('select-plan-btn')) return;
                
                const { megas, promoMegas, price, regularPrice, discount3to5, lifetimeDiscount } = e.target.dataset;
                selection.plan = { 
                    megas: parseInt(megas), 
                    promoMegas: parseInt(promoMegas),
                    price: parseInt(price),
                    regularPrice: parseInt(regularPrice),
                    discount3to5: parseInt(discount3to5),
                    lifetimeDiscount: parseInt(lifetimeDiscount)
                };
                
                // Track event for Facebook Pixel
                trackFacebookEvent('AddToCart', {
                    content_name: `Plan ${selection.plan.megas} Megas - ${selection.planType}`,
                    content_ids: [`plan_${selection.planType}_${selection.plan.megas}`],
                    content_type: 'product',
                    value: selection.plan.price,
                    currency: 'MXN'
                });
                
                // Ocultar secciones no relevantes
                hideNonPlanSections();
                
                document.querySelector('#planes .text-center > .promo-gradient').classList.add('hidden');
                dom.planCardsContainer.classList.add('hidden');
                document.getElementById('plan-type-buttons').classList.add('hidden');
                
                dom.addonsSection.classList.remove('hidden');
                dom.addonsSection.scrollIntoView({ behavior: 'smooth' });
                
                updateSummaryAndTotal();
            }

            function handleAddonsEvents(e) {
                const { name, value, type } = e.target;
                
                if (name === 'streaming') {
                    const netflixTiers = document.getElementById('netflix-tiers');
                    selection.streaming = { service: null, tier: null, price: 0 };
                    
                    if (netflixTiers) {
                        Array.from(netflixTiers.querySelectorAll('input')).forEach(i => i.checked = false);
                    }
                    
                    if (value === 'prime') {
                        selection.streaming = { 
                            service: addonsData.streaming.prime.name, 
                            tier: null, 
                            price: addonsData.streaming.prime.price 
                        };
                        // Track event for Facebook Pixel
                        trackFacebookEvent('AddToCart', {
                            content_name: 'Amazon Prime',
                            content_ids: ['addon_prime'],
                            content_type: 'product',
                            value: addonsData.streaming.prime.price,
                            currency: 'MXN'
                        });
                    } else if (value === 'netflix') {
                        if (netflixTiers) netflixTiers.classList.remove('hidden');
                    } else {
                        if (netflixTiers) netflixTiers.classList.add('hidden');
                    }
                    
                    if (selection.appPackage.data) {
                        renderPackageApps(selection.appPackage.data.id);
                    }
                }
                
                if (name === 'netflix-tier') {
                    const tierData = addonsData.streaming.netflix.tiers.find(t => t.id === value);
                    selection.streaming = { 
                        service: addonsData.streaming.netflix.name, 
                        tier: tierData.name, 
                        price: tierData.price 
                    };
                    // Track event for Facebook Pixel
                    trackFacebookEvent('AddToCart', {
                        content_name: `Netflix - ${tierData.name}`,
                        content_ids: [`netflix_${tierData.id}`],
                        content_type: 'product',
                        value: tierData.price,
                        currency: 'MXN'
                    });
                }
                
                if (name === 'disney') {
                    selection.disney = { service: null, tier: null, price: 0 };
                    
                    if (value !== 'none') {
                        const tierData = addonsData.disney.tiers.find(t => t.id === value);
                        selection.disney = { 
                            service: addonsData.disney.name, 
                            tier: tierData.name, 
                            price: tierData.price 
                        };
                        // Track event for Facebook Pixel
                        trackFacebookEvent('AddToCart', {
                            content_name: `Disney+ - ${tierData.name}`,
                            content_ids: [`disney_${tierData.id}`],
                            content_type: 'product',
                            value: tierData.price,
                            currency: 'MXN'
                        });
                        
                        // Si selecciona Disney+, verificar si hay Disney+ en paquete de apps y desmarcarlo
                        if (selection.appPackage.data && selection.appPackage.selectedApps.includes('Disney+ Est√°ndar')) {
                            const index = selection.appPackage.selectedApps.indexOf('Disney+ Est√°ndar');
                            if (index > -1) {
                                selection.appPackage.selectedApps.splice(index, 1);
                                
                                // Actualizar checkboxes en la UI
                                const checkboxes = document.querySelectorAll('input[name="package-app"]');
                                checkboxes.forEach(cb => {
                                    if (cb.value === 'Disney+ Est√°ndar') {
                                        cb.checked = false;
                                    }
                                });
                                
                                // Actualizar contador
                                const group = document.querySelector('.limited-checkbox-group');
                                if (group) {
                                    const limit = parseInt(group.dataset.limit);
                                    const checkedCheckboxes = group.querySelectorAll('input[name="package-app"]:checked');
                                    const counterElement = group.parentElement.querySelector('.package-selection-counter');
                                    const messageElement = group.parentElement.querySelector('.package-limit-message');
                                    
                                    if (counterElement) {
                                        counterElement.textContent = `Selecciona hasta ${limit} app${limit !== 1 ? 's' : ''}: (${checkedCheckboxes.length}/${limit})`;
                                    }
                                    
                                    if (checkedCheckboxes.length < limit && messageElement) {
                                        messageElement.classList.add('hidden');
                                        group.querySelectorAll('input[name="package-app"]').forEach(cb => {
                                            if (cb.dataset.permanentlyDisabled !== 'true') {
                                                cb.disabled = false;
                                                cb.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
                                            }
                                        });
                                    }
                                }
                            }
                        }
                    }
                    
                    if (selection.appPackage.data) {
                        renderPackageApps(selection.appPackage.data.id);
                    }
                }
                
                if (name === 'app-package') {
                    selection.appPackage = { data: null, selectedApps: [], price: 0 };
                    
                    if (value !== 'none') {
                        const pkg = addonsData.app_packages.find(p => p.id === value);
                        selection.appPackage = { 
                            data: pkg, 
                            selectedApps: [], 
                            price: pkg.price 
                        };
                        // Track event for Facebook Pixel
                        trackFacebookEvent('AddToCart', {
                            content_name: pkg.name,
                            content_ids: [`package_${pkg.id}`],
                            content_type: 'product',
                            value: pkg.price,
                            currency: 'MXN'
                        });
                        
                        // Si selecciona un paquete que incluye Disney+ y ya tiene Disney+ seleccionado, desmarcar Disney+
                        if (pkg.apps.includes('Disney+ Est√°ndar') && selection.disney.service !== null) {
                            selection.disney = { service: null, tier: null, price: 0 };
                            
                            // Actualizar radio buttons de Disney en la UI
                            const disneyRadios = document.querySelectorAll('input[name="disney"]');
                            disneyRadios.forEach(radio => {
                                if (radio.value === 'none') {
                                    radio.checked = true;
                                } else {
                                    radio.checked = false;
                                }
                            });
                        }
                    } 
                    renderPackageApps(value);
                }
                
                if (name === 'package-app') {
                    const group = e.target.closest('.limited-checkbox-group');
                    if (!group) return;
                    
                    const limit = parseInt(group.dataset.limit);
                    const allCheckboxes = group.querySelectorAll('input[name="package-app"]');
                    const messageElement = group.parentElement.querySelector('.package-limit-message');
                    const counterElement = group.parentElement.querySelector('.package-selection-counter');
                    
                    const checkedCheckboxes = group.querySelectorAll('input[name="package-app"]:checked');
                    selection.appPackage.selectedApps = Array.from(checkedCheckboxes).map(cb => cb.value);
                    
                    if (counterElement) {
                        counterElement.textContent = `Selecciona hasta ${limit} app${limit !== 1 ? 's' : ''}: (${checkedCheckboxes.length}/${limit})`;
                    }
                    
                    // Si selecciona Disney+ en el paquete de apps, desmarcar Disney+ promocional
                    if (e.target.checked && e.target.value === 'Disney+ Est√°ndar' && selection.disney.service !== null) {
                        selection.disney = { service: null, tier: null, price: 0 };
                        
                        // Actualizar radio buttons de Disney en la UI
                        const disneyRadios = document.querySelectorAll('input[name="disney"]');
                        disneyRadios.forEach(radio => {
                            if (radio.value === 'none') {
                                radio.checked = true;
                            } else {
                                radio.checked = false;
                            }
                        });
                    }
                    
                    if (checkedCheckboxes.length >= limit) {
                        if (messageElement) messageElement.classList.remove('hidden');
                        
                        allCheckboxes.forEach(cb => {
                            if (!cb.checked) {
                                cb.disabled = true;
                                cb.parentElement.classList.add('opacity-50', 'cursor-not-allowed');
                            }
                        });
                    } else {
                        if (messageElement) messageElement.classList.add('hidden');
                        
                        allCheckboxes.forEach(cb => {
                            if (cb.dataset.permanentlyDisabled !== 'true') {
                                cb.disabled = false;
                                cb.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
                            }
                        });
                    }
                }
                
                if (name === 'device') {
                    selection.devices = Array.from(document.querySelectorAll('input[name="device"]:checked'))
                        .map(cb => Object.values(addonsData.devices).find(d => d.id === cb.value))
                        .filter(Boolean);
                    
                    // Track event for Facebook Pixel for each device
                    if (e.target.checked) {
                        const device = Object.values(addonsData.devices).find(d => d.id === e.target.value);
                        if (device) {
                            trackFacebookEvent('AddToCart', {
                                content_name: device.name,
                                content_ids: [`device_${device.id}`],
                                content_type: 'product',
                                value: device.price,
                                currency: 'MXN'
                            });
                        }
                    }
                }
                
                updateSummaryAndTotal();
            }

            function validateForm() {
                const isValid = Array.from(dom.formInputs).every(input => input.checkValidity());
                dom.btnContinue.disabled = !isValid;
            }

            // Funci√≥n para formatear los adicionales como texto
            function formatAdicionales() {
                let adicionalesText = '';
                
                if (selection.streaming.price > 0) {
                    adicionalesText += `Streaming: ${selection.streaming.tier ? `${selection.streaming.service} (${selection.streaming.tier})` : selection.streaming.service}`;
                }
                
                if (selection.disney.price > 0) {
                    if (adicionalesText) adicionalesText += ' | ';
                    adicionalesText += `Disney+: ${selection.disney.tier}`;
                }
                
                if (selection.appPackage.price > 0) {
                    if (adicionalesText) adicionalesText += ' | ';
                    adicionalesText += `Paquete Apps: ${selection.appPackage.data.name}`;
                    if (selection.appPackage.selectedApps.length > 0) {
                        adicionalesText += ` (${selection.appPackage.selectedApps.join(', ')})`;
                    }
                }
                
                if (selection.devices.length > 0) {
                    if (adicionalesText) adicionalesText += ' | ';
                    adicionalesText += `Dispositivos: ${selection.devices.map(d => d.name).join(', ')}`;
                }
                
                return adicionalesText || 'Ninguno';
            }

            // Funci√≥n para crear el resumen completo
            function crearResumenCompleto() {
                let resumen = `SERVICIO: ${selection.planType === 'internet' ? 'Solo Internet' : 'Internet + TV'}\n`;
                resumen += `PLAN: ${selection.plan.promoMegas} Megas x 4 meses - $${selection.plan.price}/mes\n`;
                resumen += `TOTAL MENSUAL: $${selection.total}\n`;
                
                if (selection.streaming.price > 0 || selection.disney.price > 0 || selection.appPackage.price > 0 || selection.devices.length > 0) {
                    resumen += `\nADICIONALES:\n`;
                    
                    if (selection.streaming.price > 0) {
                        resumen += `- ${selection.streaming.tier ? `${selection.streaming.service} (${selection.streaming.tier})` : selection.streaming.service}: $${selection.streaming.price}/mes\n`;
                    }
                    
                    if (selection.disney.price > 0) {
                        resumen += `- ${selection.disney.tier ? `${selection.disney.service} (${selection.disney.tier})` : selection.disney.service}: $${selection.disney.price}/mes\n`;
                    }
                    
                    if (selection.appPackage.price > 0) {
                        resumen += `- ${selection.appPackage.data.name}: $${selection.appPackage.price}/mes\n`;
                        if (selection.appPackage.selectedApps.length > 0) {
                            selection.appPackage.selectedApps.forEach(app => {
                                resumen += `  * ${app}\n`;
                            });
                        }
                    }
                    
                    if (selection.devices.length > 0) {
                        selection.devices.forEach(device => {
                            resumen += `- ${device.name}: $${device.price}/mes\n`;
                        });
                    }
                }
                
                resumen += `\nCOSTO DE INSTALACI√ìN EXTRA: $0 (Valor $350)\n`;
                
                if (selection.portability) {
                    const discountAmount = portabilityDiscount[selection.planType];
                    resumen += `DESEO HACER PORTABILIDAD PARA EL DESCUENTO DE: $${discountAmount} EN MI SEGUNDA MENSUALIDAD\n`;
                }
                
                resumen += `PAGO INICIAL: $${selection.installPrice}\n`;
                resumen += `FECHA: ${new Date().toLocaleString('es-MX')}`;
                
                return resumen;
            }

            async function sendDataToMake(formData) {
                try {
                    // Preparar datos para Google Sheets seg√∫n las columnas especificadas
                    const sheetsData = {
                        nombre: formData.nombre, // Columna A
                        correo: formData.correo, // Columna B
                        telefono: formData.telefono, // Columna C
                        servicio: formData.servicio, // Columna D
                        plan: formData.plan, // Columna E
                        adicionales: formatAdicionales(), // Columna F (formateado como texto)
                        opcion_regalo: `Instalaci√≥n $0 (Valor $350)`, // Columna G - Instalaci√≥n gratis
                        total_mensual: formData.total, // Columna H
                        pago_inicial: formData.installPrice, // Columna I
                        fecha: new Date().toLocaleString('es-MX'), // Columna J
                        resumen: crearResumenCompleto() // Columna K
                    };
                    
                    // Enviar datos a Make.com
                    const response = await fetch(MAKE_WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(sheetsData),
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Error enviando datos a Make.com:', error);
                    // Aunque falle el env√≠o a Make.com, no impedimos que el usuario contin√∫e a WhatsApp
                    return null;
                }
            }

            async function submitAndRedirect() {
                // Validar que el formulario est√© completo antes de proceder
                const isFormValid = Array.from(dom.formInputs).every(input => input.checkValidity());
                if (!isFormValid) {
                    alert('Por favor completa todos los campos requeridos antes de continuar.');
                    return;
                }
                
                dom.continueText.classList.add('hidden');
                dom.continueLoader.classList.remove('hidden');
                dom.btnContinue.disabled = true;
                
                // A√±adir clase de loading al formulario
                dom.contactForm.classList.add('form-loading');

                const formData = {
                    nombre: document.getElementById('nombre').value,
                    correo: document.getElementById('correo').value,
                    telefono: document.getElementById('telefono').value,
                    servicio: selection.planType === 'internet' ? 'Solo Internet' : 'Internet + TV',
                    plan: `${selection.plan.promoMegas} Megas x 4 meses`,
                    precio_plan: selection.plan.price,
                    adicionales: {
                        streaming: selection.streaming.service ? {
                            servicio: selection.streaming.service,
                            plan: selection.streaming.tier,
                            precio: selection.streaming.price
                        } : null,
                        disney: selection.disney.service ? {
                            servicio: selection.disney.service,
                            plan: selection.disney.tier,
                            precio: selection.disney.price
                        } : null,
                        paquete_apps: selection.appPackage.data ? {
                            nombre: selection.appPackage.data.name,
                            apps_seleccionadas: selection.appPackage.selectedApps,
                            precio: selection.appPackage.price
                        } : null,
                        dispositivos: selection.devices.length > 0 ? selection.devices.map(d => ({
                            nombre: d.name,
                            precio: d.price
                        })) : []
                    },
                    total: selection.total,
                    installPrice: selection.installPrice,
                    portability: selection.portability,
                    portabilityDiscount: selection.portabilityDiscount
                };

                // Track event for Facebook Pixel - Purchase
                trackFacebookEvent('Purchase', {
                    value: selection.total,
                    currency: 'MXN',
                    content_ids: [`plan_${selection.planType}_${selection.plan.megas}`],
                    content_type: 'product'
                });

                // Track event for Facebook Pixel - Lead
                trackFacebookEvent('Lead', {
                    value: selection.total,
                    currency: 'MXN'
                });

                // Enviar datos a Make.com (en segundo plano, no esperamos la respuesta)
                sendDataToMake(formData).then(result => {
                    console.log('Datos enviados a Make.com:', result);
                }).catch(error => {
                    console.error('Error enviando a Make.com:', error);
                });

                // Construir mensaje para WhatsApp
                let message = `Hola, mi nombre es ${formData.nombre}.\n\nQuiero contratar el siguiente paquete:\n`;
                message += `*Servicio:* ${formData.servicio}\n`;
                message += `*Plan:* ${formData.plan} ($${formData.precio_plan})\n\n`;
                
                if (formData.adicionales.streaming || formData.adicionales.disney || formData.adicionales.paquete_apps || formData.adicionales.dispositivos.length > 0) {
                    message += "Adicionales:\n";
                    
                    if (formData.adicionales.streaming) {
                        message += `- ${formData.adicionales.streaming.servicio}${formData.adicionales.streaming.plan ? ` (${formData.adicionales.streaming.plan})` : ''}: $${formData.adicionales.streaming.precio}\n`;
                    }
                    
                    if (formData.adicionales.disney) {
                        message += `- ${formData.adicionales.disney.servicio}${formData.adicionales.disney.plan ? ` (${formData.adicionales.disney.plan})` : ''}: $${formData.adicionales.disney.precio}\n`;
                    }
                    
                    if (formData.adicionales.paquete_apps) {
                        message += `- ${formData.adicionales.paquete_apps.nombre}: $${formData.adicionales.paquete_apps.precio}\n`;
                        if (formData.adicionales.paquete_apps.apps_seleccionadas.length > 0) {
                            formData.adicionales.paquete_apps.apps_seleccionadas.forEach(app => {
                                message += `  - ${app}\n`;
                            });
                        }
                    }
                    
                    if (formData.adicionales.dispositivos.length > 0) {
                        formData.adicionales.dispositivos.forEach(d => {
                            message += `- ${d.nombre}: $${d.precio}\n`;
                        });
                    }
                    
                    message += "\n";
                }
                
                message += `*Total mensual estimado: $${formData.total}*\n`;
                message += `*Costo de Instalaci√≥n Extra:* *$0 (Valor $350)*\n`;
                
                if (formData.portability) {
                    message += `*Deseo hacer portabilidad para el descuento de: $${formData.portabilityDiscount} en mi segunda mensualidad*\n`;
                }
                
                message += `\n*Total a pagar al t√©cnico ya instalado su servicio y activo:* *$${formData.installPrice}*\n\n`;
                message += `*Mis datos de contacto son:*\nCorreo: ${formData.correo}\nTel√©fono: ${formData.telefono}`;
                
                // Redirigir a WhatsApp
                const whatsappURL = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
                window.location.href = whatsappURL;
            }

            // --- EVENT LISTENERS ---
            
            dom.planTypeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    dom.planTypeButtons.forEach(btn => {
                        btn.classList.remove('bg-indigo-600');
                        btn.classList.add('bg-transparent', 'hover:bg-slate-700');
                    });
                    button.classList.add('bg-indigo-600');
                    button.classList.remove('bg-transparent', 'hover:bg-slate-700');
                    renderPlanCards(button.id.replace('btn-', ''));
                });
            });
            
            dom.planCardsContainer.addEventListener('click', handlePlanSelection);
            
            document.getElementById('btn-addons-yes').addEventListener('click', () => {
                // Track Personalizar producto event
                trackFacebookEvent('Personalizar producto', {
                    content_name: 'Add-ons Selection',
                    content_category: 'Customization'
                });
                
                dom.addonsIntro.classList.add('hidden');
                renderAddonsOptions();
                dom.contactSection.classList.remove('hidden');
                dom.addonsOptionsContainer.scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('btn-addons-no').addEventListener('click', () => {
                dom.addonsSection.classList.add('hidden');
                dom.contactSection.classList.remove('hidden');
                dom.contactSection.scrollIntoView({ behavior: 'smooth' });
            });

            dom.addonsOptionsContainer.addEventListener('change', handleAddonsEvents);
            dom.formInputs.forEach(input => input.addEventListener('input', validateForm));
            dom.btnContinue.addEventListener('click', submitAndRedirect);
            
            // Event listener para el checkbox de portabilidad
            dom.portabilityCheckbox.addEventListener('change', function() {
                selection.portability = this.checked;
                updateSummaryAndTotal();
            });
            
            // Event listener para el bot√≥n "Ver Planes"
            dom.verPlanesBtn.addEventListener('click', function(e) {
                e.preventDefault();
                hideNonPlanSections();
                document.getElementById('planes').scrollIntoView({ behavior: 'smooth' });
            });

            // --- INICIALIZACI√ìN ---
            setPromoDate();
            renderPlanCards('internet');
        });
    </script>
</body>
</html>